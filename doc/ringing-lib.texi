\input texinfo @c -*-texinfo-*-
@c Ringing Class Library manual
@c $Id: ringing-lib.texi,v 1.47 2005/05/11 19:27:36 mjb47 Exp $
@c %**start of header
@setfilename ringing-lib.info
@settitle The Ringing Class Library
@iftex
@afourpaper
@end iftex
@c %**end of header

@include version.texi

@ifinfo
@dircategory Libraries
@direntry
* Ringing-lib: (ringing-lib).   The Ringing Class Library.
@end direntry
@end ifinfo

@ifnottex
This is the manual for the Ringing Class Library, version
@value{VERSION}.  Last updated @value{UPDATED}.

Copyright 2001--4 Martin Bright, Mark Banner and Richard Smith

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections, with no Front-Cover Texts, 
and with no Back-Cover Texts.  A copy of the license is included in 
the section entitled ``GNU Free Documentation License''.
@end ifnottex

@titlepage
@title The Ringing Class Library
@author Martin Bright
@author Mark Banner
@author Richard Smith

@page
@vskip 0pt plus 1filll
Version @value{VERSION}.  Last updated @value{UPDATED}.

Copyright @copyright{} 2001-4 Martin Bright, Mark Banner and Richard Smith

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1 or
any later version published by the Free Software Foundation; with no the
Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
Texts.  A copy of the license is included in the section entitled ``GNU
Free Documentation License''.

This document was produced using GNU Texinfo. On-line versions in both
HTML and GNU Info formats are also available.
@end titlepage
@ifnottex

@node Top, Introduction, (dir), (dir)
@top
@ifinfo

The Ringing Class Library (ringing-lib) is a library of C++ classes designed
for writing change ringing application programs.

This menu lists the available topics in the documentation. This
documentation is also available in HTML and PDF versions.
@end ifinfo
@ifhtml

The Ringing Class Library (ringing-lib) is a library of C++ classes designed
for writing change ringing application programs.

This menu lists the available topics in the documentation. This
documentation is also available in GNU Info and PDF
versions.
@end ifhtml
@end ifnottex

@contents

@menu
* Introduction::                
* Installing and using the library::  
* Rows and changes::            
* Methods::                     
* Method libraries::            
* Proof::                       
* Musical Analysis::            
* Producing printed output::    
* Copying this manual::         
* Index::                       
@end menu

@node Introduction, Installing and using the library, Top, Top
@chapter Introduction
@cindex introduction

The Ringing Class Library is a collection of C++ classes which implement
various concepts found in change ringing, and make it possible to
implement programs which use these concepts without having to write the
basic algorithms over and over again.

The library is split into several sections:
@itemize @bullet
@item
Classes for dealing with individual rows and changes, and how the
interact with each other;

@item
Classes for building and manipulating methods;

@item
Classes for accessing method libraries;

@item
Classes for proving and analysing sequences of rows;

@item
Classes for producing printed output.
@end itemize

Thus it is possible to use whatever part of the library is necessary for
your program; for example, a method editing program would use the method
classes, whereas a program to simulate call changes would just use the
row and change classes.

There are also several utilities included with the library.  These
demonstrate how to use the Ringing Class Library in your own programs,
and are useful in their own right.  Currently included are
@command{gsiril}, a peal proving program with an interface similar to
the popular MicroSIRIL program; @command{psline}, a utility to print
lines for methods in @acronym{PDF} or PostScript; and
@command{methsearch}, a program which searches for methods satisfying
various given criteria.  These utilities may be found in the @file{apps}
subdirectory.

To get information about latest releases of the Ringing Class Library,
to report bugs, request features, use forums and access the CVS
repository, visit the project web page at
@uref{http://ringing-lib.sourceforge.net}.

@node Installing and using the library, Rows and changes, Introduction, Top
@chapter Installing and using the library
@cindex installation

The Ringing Class Library has been developed primarily for use on
Unix-like and Microsoft Windows platforms.  As the library is written in
portable C++ and uses only standard library functions, it should be
possible to use it on any standard-conforming platform.  If you do find
a platform on which it is not possible to compile and use the library,
the authors would be interested to hear about it.

Various characteristics of the C++ compiler need to be determined before
compiling the library, and are assumed to be that same when the library
is compiled and linked into an application.  If you get a new C++
compiler or a new standard C++ library, you should reconfigure and
(probably) recompile the library before trying to use it in an
application.  The necessary data is stored in @file{ringing/common.h}:
on Unix systems this file is generated automatically; on other systems,
you may have to generate it by hand from the template in
@file{ringing/common.h.in}.

@menu
* Licensing::                   
* The Standard Template Library::  
* Unix-like systems::           
* Microsoft Windows::           
* Testing the library::         
* Using the library in your programs::  
@end menu

@node Licensing, The Standard Template Library, Installing and using the library, Installing and using the library
@section Licensing

As of version 0.2.9, the Ringing Class Library is split into two parts,
which are licensed differently.  This is explained again in the file
@file{COPYING} in the distribution.  A summary is given here, but to be
sure you should consult individual files for their licensing conditions.

@itemize @bullet
@item
Most of the library is released under the GNU Public License
(@acronym{GPL}).  A copy of this licence can be found in the file
@file{COPYING.GPL} in the top directory of the distribution.  This
licence allows you to copy, modify and distribute the library, provided
that you stay within the stated terms.  However, it does @strong{not}
allow you to include the library in your own commercial programs.  Any
programs which use the library must again be free.  For full details,
please read the text of the licence.

@item
A @dfn{core} part of the library is under the Lesser GNU Public License
(@acronym{LGPL}).  A copy of this licence can be found in the file
@file{COPYING.LGPL} in the top directory of the distribution.  Unlike
the @acronym{GPL}, this licence @emph{does} allow you to use this part
of the library in commercial programs.  The reason for releasing the
core part of the library under the @acronym{LGPL} is principally to
encourage authors to use the online method database at
@url{http://methods.ringing.org/} in their programs, whether commercial
or not.  All the files you need to use that database are under the
@acronym{LGPL}.
@end itemize

@quotation Important
Using any part of the library in a commercial program, @emph{except} for
those parts specifically stated to be under the weaker @acronym{LGPL},
is against the terms of the licence.  If in doubt, ask the authors.
@end quotation

@node The Standard Template Library, Unix-like systems, Licensing, Installing and using the library
@section The Standard Template Library
@cindex Standard Template Library
@cindex STL

Before you can use the Ringing Class Library, you will need to have a
copy of the Standard Template Library (@acronym{STL}) which works with
your compiler. The @acronym{STL} is a set of templates which define
containers such as lists and sets, iterators to move through them, and
various other useful things.  If your compiler complains about not being
able to find files such as @file{vector.h} and @file{list.h} then this
probably means that you don't have the @acronym{STL} and need to get
hold of it.

A suitable version of the @acronym{STL} is included with most major C++
compilers.  If you don't have a working version, you may be able to
download one: in particular, there is a free implementation of the
@acronym{STL} available currently at @uref{http://www.sgi.com/tech/stl}.
Implementations differ slightly in how the header files are named and
whether namespaces are used.  If you are compiling the Ringing Class
Library on a Unix-like platform, the configuration process should take
care of finding out how your particular implementation works.
Otherwise, you will need to edit the file @file{ringing/common.h.in}
before compiling.

@node Unix-like systems, Microsoft Windows, The Standard Template Library, Installing and using the library
@section Unix-like systems

The Ringing Class Library package uses the GNU tool @command{autoconf}
to take away the problems of coping with differences between platforms.  
This means that you should be able to change to the top-level directory
of the source distribution and type
@example
./configure
@end example
@noindent
to configure the package.  This will determine the characteristics of
your C++ compiler and create a file @file{ringing/common.h} which defines
various symbols used in the compilation.  This file is also installed
with the rest of the class library, so that the installed header files
will have access to it.

You can control many aspects of how the package is compiled and installed
by passing arguments to the @command{configure} script; for example, you 
can control where the library is installed (for example, in @file{/usr/lib}
or @file{/usr/local/lib}).  For details of all the options which are
accepted, type
@example
./configure --help
@end example
@noindent
in the top-level directory of the distribution.  Some more instructions
for using the @command{configure} script are given in the file
@file{INSTALL}.

On most platforms, it should be possible to build and install either
static or dynamic libraries, or both.

@node Microsoft Windows, Testing the library, Unix-like systems, Installing and using the library
@section Microsoft Windows

When compiling on Microsoft Windows, the range of different compilers and
lack of a standard powerful scripting language make it difficult to
provide a genuinely portable infrastructure to the package.  However, the
task of compiling and installing the library is not complicated, and easy
to achieve by hand.  The following steps are necessary:
@itemize @bullet
@item Create the file @file{ringing/common-ac.h} by editing 
@file{common-ac.h.in} to reflect the characteristics of your C++ compiler;

@item Compile all the @file{.cpp} source files in the @file{ringing}
subdirectory into a library, which you will probably want to call
@file{ringing.lib};

@item Install the compiled library and the header files in places where
your compiler and linker will be able to find them;

@item Optionally, install and run the tests in the @file{tests}
subdirectory.

@item Copy the documentation to somewhere permanent.

@item If desired, compile and install the utilities in the @file{apps}
subdirectory.
@end itemize

Note that the header files are designed to be included from a
subdirectory called @file{ringing} within your system's collection of
header files.

If you wish to compile only the part of the library which is licensed
for use in commercial programs, make sure you only compile and link
those files which explicitly state that they are under the Lesser GNU
Public License @acronym{LGPL}.  @xref{Licensing}.

If you are using Microsoft Developer Studio, then you can use the
supplied workspace file @file{ringing-lib.dsw} to accomplish the
compiling and linking of the library without any effort.  In addition,
with the Microsoft Visual Studio compiler you do not need to edit
@file{ringing/common-ac.h} by hand: there is a ready-customised version,
called @file{common-msvc.h}, which will be found and used automatically.

Currently the class library should normally be compiled into a static
library (@file{.lib} file).  It is not yet straightforward to make the
library into a DLL; if you choose to do this, you are on your own but
the authors would be please to hear of any success.

@node Testing the library, Using the library in your programs, Microsoft Windows, Installing and using the library
@section Testing the library

The library is provided with basic test facilities that
exercise the main classes and provide confidence that they are working
correctly.

The tests are found under the @file{tests} directory and are linked into
one executable called @command{test}. If all tests are succesfully a message
will be printed stating this on the last line of output of the program.

@node Using the library in your programs,  , Testing the library, Installing and using the library
@section Using the library in your programs

To use the Ringing Class Library in your programs, you simply include
the relevant header files in your source code, and then link the library
into your final program.

Header files are expected to be found in the subdirectory @file{ringing};
thus you might type

@example
#include <ringing/row.h>
#include <ringing/proof.h>
@end example

@noindent
at the top of a C++ source code file.  If this does not work, either your
compiler is not looking in the right place for the header files, or you
have not installed them in the right place.  You may be able to correct
this by adding an option (@code{-I} on most systems) to your compiler
command line.

To link to the installed library, simply add the appropriate option to
the command line when linking your program.  On most Unix systems, you
will have to add @code{-lringing} to link with the library.

@node Rows and changes, Methods, Installing and using the library, Top
@chapter Row and change classes
@cindex row
@cindex change

Classes for manupulating rows and changes, and all the other classes and
functions described in this chapter, are declared in @file{ringing/row.h}.

For ease of notation, we use the idea that a @dfn{row} is an individual
permutation of bells (such as @samp{13572468}), and a @dfn{change} is a
means of getting from one row to another, by swapping pairs of bells;
the most convenient way to write a change is a place notation (for
example @samp{X} or @samp{1258}).

@menu
* Row Operations::              Explanation of algebra on rows
* Row Properties::              Explanation of other properties of rows
* Changes::                     How ringing-lib deals with changes
* The bell Class::              
* The row Class::               
* The change Class::            
* The permute function::        
* The row_block class::         
* Other functions in row.h::    
@end menu

@node Row Operations, Row Properties, Rows and changes, Rows and changes
@section Row operations
@cindex row algebra
@cindex algebra of rows
@cindex row operations
@cindex transposition

Rows have a set of operations which we can use on them; in mathematical
terms, they form a group. The most important operation is that of row
multiplication or transposition - in this operation, the bells in one
row are rearranged according to the order given by another row.

For example,
@example
21345678 * 13572468 = 23571468
@end example
@noindent and
@example
13572468 * 21345678 = 31572468
@end example

Note that the two above examples do @emph{not} give the same result;
that is, the order in which two things are multiplied does matter.

As an example of how row multiplication is used, suppose that we want to
know the 4th row of the lead of Plain Bob Major with lead head
@samp{17856342}. The 4th row of the first lead (which has a lead head of
rounds) is @samp{42618375}. Multiplying these together gives us the
answer we are looking for, namely @samp{57312846}.

The identity for this operation is rounds; in other words, any row
multiplied by rounds gives itself, and rounds multiplied by any row
gives that row.

It is possible to define the inverse of a row as the row which, when
multiplied by that row, will give rounds. For example, the inverse of
@samp{13572468} is @samp{15263748}, as 
@example
13572468 * 15263748 = 12345678
@end example

The opposite of row multiplication is row division. If @samp{a * b = c},
we can define @samp{c / b = a}. Using the same example as above, suppose
we have a lead of Plain Bob Major and we know that the fourth row is
@samp{57312846}, and we wish to find the lead head. Just divide by the
fourth row of the plain course (@samp{42618375}) to get the answer.

@node Row Properties, Changes, Row Operations, Rows and changes
@section Row properties
@cindex row properties

There are several properties of rows which arise from group theory and
can be useful in looking at properties of methods.

@cindex order
The @dfn{order} of a row is the number of times which that row has to be
multiplied by itself before it gets back to rounds. For example, the row
@samp{21436587} has order 2, because if it is multiplied by itself
twice, you get back to rounds. Similarly the row @samp{23145678} has
order 3, and the row @samp{23456781} has order 8. This can be useful,
for example, in seeing how many leads of a method are needed in a plain
course before it comes round.

@cindex sign
@cindex parity
Another useful concept is the @dfn{sign} or @dfn{parity} of a row. A row
is considered @dfn{even} if it takes an even number of swaps of pairs of
bells to get from rounds to that row, and @dfn{odd} if it takes an odd
number of swaps. (It can be shown that whether the number is odd or even
doesn't depend on exactly what the sequence of swaps is).

@cindex cycles
Finally, every row can be expressed as a set of @dfn{cycles}. A cycle is
a set of bells which move round in a sequential way as the row is
repeated; for example, @samp{21345678} has only one cycle, which is
@samp{(12)}; and @samp{12356478} has one cycle, which is
@samp{(456)}. Combining these two cycles will give us the row @samp{213564678}.

@node Changes, The bell Class, Row Properties, Rows and changes
@section Changes
@cindex change

A @dfn{change} is a means for getting from one row to another. It works
by swapping over pairs of bells, and no bell may move more than one
place.

@cindex place notation
@cindex swap
The normal way of representing a change is by place notation; a single
change is represented by a series of numbers which each correspond to a
place being made; for example, @samp{12} means that all bells swap,
apart from the 1 and the 2, which stay in the same place. If all the
bells swap, the place notation is @samp{X}.

@node The bell Class, The row Class, Changes, Rows and changes
@section The @code{bell} class
@cindex @code{bell} class

The @code{bell} class represents a single bell.  An object of type
@code{bell} is essentially an integer, and bells are numbered starting
with the treble as 0.  Member functions are provided to convert between
this numerical representation and a printable character.  The class
library can cope with up to 256 bells, though only bells numbered from 0
to 32 may be described by a printable character.

@menu
* bell Derivation::             
* bell Constructors::           
* bell Operators::              
* Other bell Functions::        
@end menu

@node bell Derivation, bell Constructors, The bell Class, The bell Class
@subsection Derivation

This class is not derived from any other classes.

@example
class bell;
@end example

@node bell Constructors, bell Operators, bell Derivation, The bell Class
@subsection Constructors

@deftypefn Constructor {} bell::bell (void);
This constructor initialises the bell object to zero (0).
@end deftypefn

@deftypefn Constructor {} bell::bell (int @var{i});
This constructor initialises the bell object to the integer @var{i},
where bells are numbered starting from 0.
@end deftypefn

@node bell Operators, Other bell Functions, bell Constructors, The bell Class
@subsection Operators

@deftypefn Operator bell& bell::operator= (int @var{i});
This assigns the integer value @var{i} to the bell object, where bells
are numbered starting from 0.
@end deftypefn

@deftypefn Operator int {bell::operator int} (void);
This casts a bell object to the corresponding integer.
@end deftypefn

@deftypefn Operator ostream& operator<< (ostream& @var{o}, const bell @var{b});
This operator writes the character representing the bell @var{b} to the
output stream @var{o}.
@end deftypefn

@node Other bell Functions,  , bell Operators, The bell Class
@subsection Other functions

@deftypefun bell& bell::from_char (char @var{c});
This function interprets the character @var{c} as a bell, and assigns
that value to the bell object.  See the next function for the mapping
between characters and bells.  If the character does not represent a
valid bell, then an exception of the class @code{bell::invalid} is
thrown; if you have disabled exceptions, the bell is set to the value
@code{bell::MAX_BELLS}.  The function returns @code{*this}.
@end deftypefun

@deftypefun char bell::to_char (void) const;
This function returns a character indicating the bell represented by the
object.  The characters used are, in order:
@example
1234567890ETABCDFGHJKLMNPQRSUVWYZ
@end example
@end deftypefun

@node The row Class, The change Class, The bell Class, Rows and changes
@section The @code{row} class
@cindex @code{row} class

The @code{row} class stores a single row. It provides extensive
functions to manipulate rows and perform operations on them.

@menu
* row Derivation::              
* row Constructors::            
* row Operators::               
* Other row Functions::         
* row static Functions::        
@end menu

@node row Derivation, row Constructors, The row Class, The row Class
@subsection Derivation

This class is not derived from any other classes.

@example
class row;
@end example

@node row Constructors, row Operators, row Derivation, The row Class
@subsection Constructors

@deftypefn Constructor {} row::row (void);
This constructs an empty row.
@end deftypefn

@deftypefn Constructor explicit row::row (int @var{bells});
This constructs an empty row, where @var{bells} is the number of bells
which the row is to contain.  Note that it is not initialised to
anything.
@end deftypefn

@deftypefn Constructor {} row::row (const char* @var{s});
@deftypefnx Constructor {} row::row (const string& @var{s});
This constructs a row from a string, which should be the textual
representation of the row you wish to construct, for example
@samp{"135246"} or @samp{"2143658709TE"}.  If the string does not
contain a valid row, and if exceptions are enabled, an exception of 
class @code{row::invalid} is
thrown.
@end deftypefn

@deftypefn Constructor {} row::row (const row& @var{r});
This is the copy constructor; it creates a copy of the given row.
@end deftypefn

@node row Operators, Other row Functions, row Constructors, The row Class
@subsection Operators

@deftypefn Operator row& row::operator= (const row& @var{r});
This copies one row to another.
@end deftypefn

@deftypefn Operator row& row::operator= (const char* @var{s});
@deftypefnx Operator row& row::operator= (const string& @var{s});
This sets the value of a row, given a string. The string @var{s} should
contain a textual representation of a row, such as @samp{21436587}.  If
the string is not valid, a @code{row::invalid} exception is thrown.
@end deftypefn

@deftypefn Operator bool row::operator== (const row& @var{r}) const;
@deftypefnx Operator bool row::operator!= (const row& @var{r}) const;
These compare two rows.
@end deftypefn

@deftypefn Operator bell row::operator[] (int @var{i}) const;
This returns the @var{i}th bell in the row.  Note that this is not an
lvalue, so you cannot assign a value to an individual bell in a row.
@end deftypefn

@deftypefn Operator row row::operator* (const row& @var{r}) const;
@deftypefnx Operator row& row::operator*= (const row& @var{r});
These functions multiply two rows together as explained above.  If the
rows are not of the same length, the shorter row is considered to be
first padded out to the length of the longer row by adding the extra
bells in order at the end.
@end deftypefn

@deftypefn Operator row row::operator/ (const row& @var{r}) const;
@deftypefnx Operator row& row::operator/= (const row& @var{r});
These functions divide two rows, as explained above.  If the rows are
not of the same length, the shorter row is padded as for multiplication.
@end deftypefn

@deftypefn Operator row& operator*= (row& @var{r}, const change& @var{c});
@deftypefnx Operator row row::operator* (const change& @var{c}) const;
These functions apply a change to a row.  If the number of bells @var{c}
differs from the number of bells in @var{r}, then @var{c} is considered
to be padded or truncated in the obvious way.
@end deftypefn

@deftypefn Operator ostream& operator<< (ostream& @var{o}, const row& @var{r});
This writes the row to the given output stream, in the same format as
returned by @code{row::print()}.
@end deftypefn

@deftypefn Operator bool row::operator< (const row& @var{other});
@deftypefnx Operator bool row::operator> (const row& @var{other});
@deftypefnx Operator bool row::operator<= (const row& @var{other});
@deftypefnx Operator bool row::operator>= (const row& @var{other});
These functions perform a lexicographical comparison of the two rows.
They are necessary in order that rows may be put into certain containers.
@end deftypefn

@node Other row Functions, row static Functions, row Operators, The row Class
@subsection Other functions

@deftypefun int row::bells (void) const;
This returns the number of bells which the row contains.
@end deftypefun

@deftypefun void row::swap (row& @var{other});
This function swaps this row with @var{other} in an efficient manner.
@end deftypefun

@deftypefun int row::find (bell const& @var{b});
This function locates the bell, @var{b}, in this row and returns its
place.
@end deftypefun

@c Silly bit to get round a bug
@ifinfo
@deftypefun row& row::rounds (void);
This sets the row to rounds.
@end deftypefun
@end ifinfo
@iftex
@deftypefun row@& row::rounds (void);
This sets the row to rounds, and returns @code{*this}.
@end deftypefun
@end iftex

@deftypefun bool row::isrounds (void) const;
This returns true if the row is rounds, and false otherwise.
@end deftypefun

@deftypefun int row::ispblh (void) const;
If the row is a lead head of Plain Bob, Grandsire or, more generally, of
the Plain Bob type method with any number of hunt bells, then this
function returns an integer indicating which lead head it is.
Otherwise, it returns 0.
@end deftypefun

@deftypefun int row::ispblh (int @var{h}) const;
If the row is a lead head of Plain Bob, Grandsire or, more generally, of
the Plain Bob type method with @var{h} hunt bells, then this
function returns an integer indicating which lead head it is.
Otherwise, it returns 0.
@end deftypefun

@deftypefun string row::print (void) const;
This prints the row to a string object.
@end deftypefun

@deftypefun row row::inverse (void) const;
This returns the inverse of a row, as explained above.
@end deftypefun

@deftypefun int row::sign (void) const;
This returns the sign or parity of a row:  1 for even, -1 for odd.
@end deftypefun

@deftypefun int row::order (void) const;
This returns the order of the row.
@end deftypefun

@deftypefun string row::cycles (void) const;
This expresses the row as separate cycles. The returned string will
afterwards contain a list of all the cycles in the row, separated by
commas; for example @code{row("21453678").cycles()} will return the
string @code{"12,345,6,7,8"}.
@end deftypefun

@deftypefun {template <> void} swap<row> (row& @var{a}, row& @var{b});
This specialised the @code{swap} function which is defined in the
standard library.  The result is that certain standard algorithms may 
become much more efficient.  Note that according to your namespace
setup, @code{swap} may need to be in namespace @code{std}; similarly,
@code{row} may or may not be in namespace @code{ringing}.  This is all
taken care of.
@end deftypefun

@node row static Functions,  , Other row Functions, The row Class
@subsection @code{static} functions

@deftypefun {static row} row::rounds (int @var{n});
@deftypefunx {static row} row::queens (int @var{n});
@deftypefunx {static row} row::kings (int @var{n});
@deftypefunx {static row} row::tittums (int @var{n});
@deftypefunx {static row} row::reverse_rounds (int @var{n});
These return the row corresponding to rounds, queens, kings, tittums and 
reverse rounds respectively on @var{n} bells.
@end deftypefun

@deftypefun {static row} row::pblh (int @var{n}, int @var{h} = 1);
This returns the first lead head of Plain Bob (@var{h} = 1), Grandsire
(@var{h} = 2), or more generally the Plain Bob type method on @var{n}
bells with @var{h} hunt bells.
@end deftypefun

@deftypefun {static row} row::cyclic (int @var{n}, int @var{h} = 1, int @var{c} = 1);
This returns a cyclic row on @var{n} bells with @var{h} initial fixed 
(hunt) bells.  The variable @var{c} controls the number of bells moved 
from the front of the row to the end.  Thus, @code{cyclic(6,1,2) == "145623"}.
@end deftypefun

@node The change Class, The permute function, The row Class, Rows and changes
@section The @code{change} class
@cindex @code{change} class

The @code{change} class stores a single change, i.e. a means of getting
from one row to another.

@menu
* change Derivation::           
* change Constructors::         
* change Operators::            
* Other change Functions::      
@end menu

@node change Derivation, change Constructors, The change Class, The change Class
@subsection Derivation

This class is not derived from any other classes.

@example
class change;
@end example

@node change Constructors, change Operators, change Derivation, The change Class
@subsection Constructors

@deftypefn Constructor {} change::change (void);
This constructs an empty change.
@end deftypefn

@deftypefn Constructor explicit change::change (int @var{n});
This constructs an empty change for @var{n} bells, which will initially
contain no swaps, that is, all bells will remain in the same place.
@end deftypefn

@deftypefn Constructor {} change::change (const change& @var{c});
This is the copy constructor; it makes a new copy of @var{c}.
@end deftypefn

@deftypefn Constructor {} change::change (int @var{n}, char* @var{pn});
@deftypefnx Constructor {} change::change (int @var{n}, const string& @var{pn});
This constructs a change on @var{n} bells, with place notation as given
in @var{pn}. This should consist of a sequence of characters which signify
the places to be made, arranged in ascending order. If no places are to
be made, the string @code{"X"} should be used. Note that you
can miss out external places, unless no internal places are made at
all.  If the place notation is not valid, this constructor will throw an
exception of class @code{change::invalid}.
@end deftypefn

@node change Operators, Other change Functions, change Constructors, The change Class
@subsection Operators

@deftypefn Operator change& change::operator= (const change& @var{c});
This assigns the value of one change to another.
@end deftypefn

@deftypefn Operator bool change::operator== (const change& @var{c}) const;
@deftypefnx Operator bool change::operator!= (const change& @var{c}) const;
These compare two changes.  Note that to be equal, the changes must be
defined on the same number of bells; for example, @samp{"12"} on 4
bells is different from @samp{"12"} on 6 bells.
@end deftypefn

@deftypefn Operator bell& operator*= (bell& @var{b}, const change& @var{c});
@deftypefnx Operator bell operator* (bell @var{b}, const change& @var{c});
These return the effect of applying the change @var{c} to the bell
@var{b}. For example, @code{3 * change(4,"34") == 4}. This is useful in 
tracing the path of one particular bell through a series of changes.
@end deftypefn

@deftypefn Operator ostream& operator<< (ostream& @var{o}, const change& @var{c});
This writes the place notation for the change @var{c} to the given
output stream.
@end deftypefn

@deftypefn Operator bool change::operator< (const change& @var{c}) const;
@deftypefnx Operator bool change::operator> (const change& @var{c}) const;
@deftypefnx Operator bool change::operator<= (const change& @var{c}) const;
@deftypefnx Operator bool change::operator>= (const change& @var{c}) const;
If both changes have the same number of bells, these performs a 
lexicographical comparison on the swaps present in each changes; for 
example @code{change(6, "14")} compares less than @code{change(6, "1236")}.

If the two changes have different numbers of bells the one with fewer 
bells compares less than the one with more bells.
@end deftypefn

@node Other change Functions,  , change Operators, The change Class
@subsection Other functions

@deftypefun void change::swap (change& @var{c});
This function swaps this change with the change given by @var{c} in an
efficient manner.
@end deftypefun

@deftypefun int change::bells (void) const;
This returns the number of bells on which the change is defined.
@end deftypefun

@deftypefun int change::sign (void) const;
This returns the sign of the change: -1 if an odd number of pairs are
swapped, +1 if an even number of pairs are swapped.
@end deftypefun

@deftypefun bool change::findswap (bell @var{i}) const;
Returns true if the change swaps bells @var{i} and @var{i+1}, and false
otherwise.
@end deftypefun

@deftypefun bool change::findplace (bell @var{i}) const;
Returns true if the change doesn't move the bell in the @var{i}th place
(i.e. if @var{i}ths place is made), and false otherwise.
@end deftypefun

@deftypefun int change::count_places (void) const;
This function returns the number of places made in the change.
@end deftypefun

@deftypefun bool change::swappair (int @var{i});
If the change doesn't currently swap bells @var{i} and @var{i+1}, then
this will add that swap.  If those bells are swapped, this will remove
the swap.  If the bells @var{i-1} and @var{i}, or @var{i+1} and
@var{i+2}, are currently swapped, those swaps are removed.

This returns true if after the function call, the pair of bells @var{i} 
and @var{i+1} are swapped, and false otherwise.  If exceptions are enabled and
the bell @var{i+1} is greater the number of bells in the change, an 
exception of class @code{change::out_of_range} will be thrown.

This function makes it possible for the user to edit changes in such a
way that they will always end up in a sensible state.
@end deftypefun

@deftypefun change change::reverse (void) const;
This returns the reverse of a change; that is, the change is flipped
over so that on 8 bells for example, 2nds place becomes 7ths place and
so on.
@end deftypefun

@deftypefun bool change::internal (void) const;
This returns true if the change contains internal places, and false otherwise.
@end deftypefun

@deftypefun string change::print (void) const;
This function prints the place notation for the change to a string.
@end deftypefun

@deftypefun {template <> void} swap<change> (change& @var{a}, change& @var{b});
This specialised the @code{swap} function which is defined in the
standard library.  The result is that certain standard algorithms may 
become much more efficient.  Note that according to your namespace
setup, @code{swap} may need to be in namespace @code{std}; similarly,
@code{change} may or may not be in namespace @code{ringing}.  This is all
taken care of.
@end deftypefun

@node The permute function, The row_block class, The change Class, Rows and changes
@section The @code{permute} function
@cindex @code{permute} function

The @code{permute} function is a utility function which makes it possible to
use some of the standard algorithms contained in the C++ library.  There are 
two forms of the function:  the first takes an unsigned integer as
its argument, and the second takes a reference to a row.  In either case,
a function object (of type @code{permuter} or @code{row_permuter}) is returned,
which can be used with standard algorithms.

@deftypefun {inline permuter} permute (unsigned @var{n});
This global function returns a function object of type @code{permuter}, which
contains a row initialised to rounds on @var{n} bells.  When the function
object is called with an argument of either a row or change, its internal
row is multiplied by that row or change and then returned.
@end deftypefun

@deftypefun {inline row_permuter} permute (row& @var{r});
This global function creates a @code{row_permuter} function object, which
contains a reference to the row @var{r}.  When the function object is called
with a row or change as an argument, the row @var{r} will be multiplied
by that row or change.
@end deftypefun

@deftypefn Operator {const row&} {permuter::operator()} (const row& @var{r});
@deftypefnx Operator {const row&} {permuter::operator()} (const change& @var{c});
These operators multiply the permutation contained in the @code{permuter}
object by the given row or change, and return the new permutation.
@end deftypefn

@deftypefn Operator {const row&} {row_permuter::operator()} (const row& @var{r});
@deftypefnx Operator {const row&} {row_permuter::operator()} (const change& @var{c});
These operators multiply the row which the @code{row_permuter} object refers
to by the given row or change.  A reference to that row is returned.
@end deftypefn

@node The row_block class, Other functions in row.h, The permute function, Rows and changes
@section The @code{row_block} class
@cindex @code{row_block} class

The @code{row_block} class is an array of rows which has associated with
it a reference to an array of changes, and can recalculate itself from
those changes.  For example, suppose that the variable @code{c} of type
@code{vector<change>} holds one lead of a method; then it is possible to
define a variable of type @code{row_class} which, once it is told what
the lead head is, will calculate the rows for one lead of the method.

Note that the @code{row_block} object does not store its own copy of the
@code{vector<change>} object from which it is calculated.  This means
that the changes may be altered and the resulting rows recalculated
easily; it also means that the changes must not be deallocated while the
@code{row_block} object is in existence.

@menu
* row_block Derivation::        
* row_block Constructors::      
* Other row_block Functions::   
@end menu

@node row_block Derivation, row_block Constructors, The row_block class, The row_block class
@subsection Derivation

The @code{row_block} class is derived from @code{vector<row>}.

@example
class row_block : public vector<row>;
@end example

@node row_block Constructors, Other row_block Functions, row_block Derivation, The row_block class
@subsection Constructors

@deftypefn Constructor {} row_block::row_block (const vector<change>& @var{c});
This creates a block of rows using the changes in @var{c}, starting
from rounds.
@end deftypefn

@deftypefn Constructor {} row_block::row_block (const vector<change>& @var{c}, const row& @var{r});
This creates a block of rows using the changes in @var{c}, starting from
the row given in @var{r}.
@end deftypefn

@node  Other row_block Functions,  , row_block Constructors, The row_block class
@subsection Other functions

@ifinfo
@deftypefun row& row_block::set_start (const row& @var{r});
This sets the first row to @var{r}.  Note that this function does @emph{not}
recalculate the rest of the rows afterwards; you must do this by calling
@code{recalculate()}.
@end deftypefun
@end ifinfo
@iftex
@deftypefun row@& row_block::set_start (const row& @var{r});
This sets the first row to @var{r}.  Note that this function does @emph{not}
recalculate the rest of the rows afterwards; you must do this by calling
@code{recalculate()}.
@end deftypefun
@end iftex

@ifinfo
@deftypefun row_block& row_block::recalculate (int @var{start} = 0);
This recalculates all the rows in the array, starting from the element
numbered @var{start}; if this is not specified, all the rows are recalculated.
If, for example, you know that the @code{changes} object which the row block
is based on has been changes halfway through, you don't have to recalculate
all the rows, just the ones after that point.
@end deftypefun
@end ifinfo
@iftex
@deftypefun row_block@& row_block::recalculate (int @var{start} = 0);
This recalculates all the rows in the array, starting from the element
numbered @var{start}; if this is not specified, all the rows are recalculated.
If, for example, you know that the @code{changes} object which the row block
is based on has been changes halfway through, you don't have to recalculate
all the rows, just the ones after that point.
@end deftypefun
@end iftex

@ifinfo
@deftypefun {const vector<change>&} row_block::get_changes (void) const;
This returns the @code{vector<change>} object on which the row block is based.
@end deftypefun
@end ifinfo
@iftex
@deftypefun {const vector<change>@&} row_block::get_changes (void) const;
This returns the @code{vector<change>} object on which the row block is based.
@end deftypefun
@end iftex

@node Other functions in row.h,  , The row_block class, Rows and changes
@section Other functions in @file{row.h}

@deftypefun {template<OutputIterator, ForwardIterator> void} interpret_pn (int @var{bells}, ForwardIterator @var{start}, ForwardIterator @var{finish}, OutputIterator @var{out});
This template function is for expanding place notation into changes.  The
arguments are as follows: @var{bells} is the number of bells; @var{start} and
@var{finish} should be forward iterators with value type @code{char}, and
indicate a string of characters containing the place notation; and @var{out}
is an output iterator of value type @code{change}, to which the changes
will be written.

The syntax of the place notation is as follows: place notation consists of 
a sequence of blocks, which are delimited by commas.  Each block is a 
sequence of changes, with @samp{X} or @samp{-} meaning a cross change.
Changes other than cross changes are separated by full stops.
A block may optionally be preceded by an ampersand @samp{&}, which means
that the entire block, except the last change, is repeated backwards.  All
other characters are ignored.

For examples of this function in use, look at one of the @code{method} 
constructors in @file{ringing/method.h} or in the example code.
@end deftypefun

@node Methods, Method libraries, Rows and changes, Top
@chapter Method classes
@cindex method

The Ringing Class Library provides many useful functions for dealing with
methods, finding information about them and classifying them.

A @dfn{method} consists of one block of changes which is repeated over
and over again; this is called a @dfn{lead}.  If, at the end of one
lead, every bell is in a different position, then the method is called a
@dfn{principle} and the leads are called @dfn{divisions}.  Any bells is
a method which end up in the same place at the end of a lead are called
@dfn{hunt bells}.

The Ringing Class Library defines an object @code{method} which is
simply a block of changes (it is derived from @code{vector<change>}) and
which provides a large range of member functions.  Many of these are
used for finding out things about the method, such as the number of
leads in the plain course, the type of method, the full name and so on.

@menu
* The method Class::            
@end menu

@node The method Class,  , Methods, Methods
@section The @code{method} class
@cindex @code{method} class

The @code{method} class represents a method by storing the changes which
make up one lead of the method.  This class is declared in
@file{ringing/method.h}.

A method may have a name, which is a string variable.  This name is the
@dfn{base name} of the method, that is, it is the name without any extra
bits such as `Surprise' or `Triples'.  For example, the base name of
Plain Bob Major is simply `Plain'.  The parts of the name other than the
base can be worked out by the Ringing Class Library.

@menu
* method Derivation::           
* method Constructors::         
* Other method Functions::      
* method static Functions::     
* method static Variables::     
@end menu

@node method Derivation, method Constructors, The method Class, The method Class
@subsection Derivation

The @code{method} class is derived from @code{vector<change>}:
@example
class method : public vector<change>
@end example

@node method Constructors, Other method Functions, method Derivation, The method Class
@subsection Constructors

@deftypefn Constructor explicit method::method (int @var{length} = 0, int @var{bells} = 0, char* @var{name} = "Untitled");
This constructor creates an empty method on @var{bells} bells, with
@var{length} changes in the lead, and with name @var{name}.  All the
bells stay in the same place for the entire lead.
@end deftypefn

@deftypefn Constructor {} method::method (const char* @var{pn}, int @var{bells}, char* @var{name} = "Untitled");
@deftypefnx Constructor {} method::method (const string& @var{pn}, int @var{bells}, const string& @var{name} = "Untitled");
This constructor creates a method on @var{bells} bells from the given
place notation, which should be an entire lead.  The method is given the base 
name @var{name}.  For information on how to specify
the place notation, see the discussion of @code{interpret_pn} in 
@ref{Other functions in row.h}.
@end deftypefn

@deftypefn Constructor {} method::method (const method& @var{m});
This is the copy constructor.
@end deftypefn

@node Other method Functions, method static Functions, method Constructors, The method Class
@subsection Other functions

@deftypefun {const char*} method::name (void) const;
This returns the base name of the method.  Note that this may be an empty
string, for example in Little Bob.
@end deftypefun

@deftypefun void method::name (const char* @var{name});
@deftypefunx void method::name (const string& @var{name});
This sets the base name of the method to @var{name}.
@end deftypefun

@deftypefun int method::bells (void) const;
This returns the number of bells on which the method is defined.
@end deftypefun

@deftypefun int method::length (void) const;
This returns the number of changes in a lead of the method.
@end deftypefun

@deftypefun void method::push_back (const change& @var{c});
@deftypefunx void method::push_back (const string& @var{s});
These utility functions add a change to the end of the method.  In
the first case, @var{c} is the change to be added; in the second case,
@var{s} is place notation for the change to be added.
@end deftypefun

@deftypefun row method::lh (void) const;
This returns the first lead head of the method.
@end deftypefun

@deftypefun bool method::issym (void) const;
This returns true if the method is symmetrical about the half lead (and has
an even number of changes in the lead), or false otherwise.
@end deftypefun

@deftypefun bool method::isdouble (void) const;
This returns true if the method is double, or false otherwise.  Note that 
double does not imply symmetrical.
@end deftypefun

@deftypefun bool method::isregular (void) const;
This returns true if the method is regular (that is, has Plain Bob lead 
heads), or false otherwise.
@end deftypefun

@deftypefun int method::huntbells (void) const;
This returns the number of hunt bells in the method.
@end deftypefun

@deftypefun int method::leads (void) const;
This returns the number of leads in the plain course of the method.
@end deftypefun

@deftypefun char* method::lhcode (void) const;
This returns the standard code for the lead end and lead head of the
method.  The result is stored in a static internal buffer.
@end deftypefun

@deftypefun bool method::issym (bell @var{b}) const;
This returns true if the path of bell @var{b} in a lead of the method is
symmetrical about the half lead, or false otherwise.
@end deftypefun

@deftypefun bool method::isplain (bell @var{b} = 0) const;
This returns true if bell @var{b} plain hunts for the whole lead of the
method, or false otherwise.
@end deftypefun

@deftypefun bool method::hasdodges (bell @var{b}) const;
This returns true if bell @var{b} dodges during the lead, or false otherwise.
@end deftypefun

@deftypefun bool method::hasplaces (bell @var{b}) const;
This returns true if bell @var{b} makes any internal places during the lead,
or false otherwise.
@end deftypefun

@deftypefun int method::methclass (void) const;
This function returns an integer which depends on the class of the
method.  The following values are defined:
@example
enum method::m_class @{
  M_UNKNOWN, M_PRINCIPLE, M_BOB, M_PLACE, M_TREBLE_BOB, M_SURPRISE, 
  M_DELIGHT, M_TREBLE_PLACE, M_ALLIANCE, M_HYBRID, M_SLOW_COURSE,
  M_MASK = 0x0f,
  M_DIFFERENTIAL = 0x10,
  M_LITTLE = 0x80
@};
@end example
The @code{M_DIFFERENTIAL} and @code{M_LITTLE} bits are flags which will be 
either set or cleared accordingly.  (For the purpose of this function, 
``Differential'' is considered a method class.  Differential hunters will have
the @code{M_DIFFERENTIAL} bit set, together with one of the other classes;
differential methods will return @code{M_DIFFERENTIAL | M_PRINCIPLE}.)
@end deftypefun

@deftypefun char* method::fullname (char* @var{buffer}) const;
This function places the full name of the method in @var{buffer}, which
should be long enough to receive it, and returns a pointer to it.  The
full name consists of:
@itemize @bullet
@item
the base name of the method;
@item
the word ``Little'', if appropriate;
@item
the class of the method, or none if it is a principle;
@item
the stage (number of bells) of the method.
@end itemize

Note that Grandsire, Union and their related methods are treated specially:
the full name of these methods does not include their class, nor in the 
case of Little Grandsire does it contain ``Little''.
@end deftypefun

@deftypefun string method::fullname (void) const;
This function returns the full name of the method as a string.
@end deftypefun

@deftypefun int method::maxblows (void) const;
This function returns the maximum consecutive blows made in any place in 
this method.  (If the method has one bell fixed throughout, the lead length
is returned.)
@end deftypefun

@node method static Functions, method static Variables, Other method Functions, The method Class
@subsection @code{static} functions

@deftypefun {static const char*} method::stagename (int @var{bells});
This function returns a pointer to a string describing the stage of 
@var{bells} bells:  thus @code{"Minimus"}, @code{"Doubles"}, and so on.
For stages above Sixteen, the number is given in digits.
@end deftypefun

@deftypefun {static string} method::classname (int @var{class});
This function returns a string describing the method class
given in @var{class}, which should be as indicated in the explanation
of @code{method::methclass()} above.  For the purpose of this function,
``Differential'' and ``Little'' are both considered to be method classes.
@end deftypefun

@node method static Variables,  , method static Functions, The method Class
@subsection @code{static} variables

@deftypevar {static const char*} method::txt_double;
This points to the string @code{"Double"}.
@end deftypevar

@deftypevar {static const char*} method::txt_little;
This points to the string @code{"Little"}.
@end deftypevar

@node Method libraries, Proof, Methods, Top
@chapter Method libraries
@cindex library
@cindex method library

The Ringing Class Library provides a extensible framework for loading
and manipulating method libraries (collections) of various types.  The
classes that provide this framework are declared in
@file{ringing/library.h}.

The class library contains built-in code for accessing certain types of
libraries.  Currently these are:

@itemize @bullet
@item
Central Council libraries in text format;

@item
MicroSIRIL libraries;

@item
XML libraries.
@end itemize

The class framework is designed so that programmers can easily add their
own types of libraries, and handle them in exactly the same way as the
build-in types.

When opening a library, it is not necessary to specify what type of
library it is:  usually this can be detected automatically.

@menu
* Using libraries::             
* Built-in library types::      
* Library framework::           
* Implementing new library classes::  
@end menu

@node Using libraries, Built-in library types, Method libraries, Method libraries
@section Using libraries

This section describes how to open and read method libraries.

@menu
* Initialisation for libraries::  
* The library class::           
* The library_entry class::     
* Facets::                      
@end menu

@node Initialisation for libraries, The library class, Using libraries, Using libraries
@subsection Initialisation

Before the auto-detection of libraries will work, the @code{library}
class needs to know which library types it should try when opening a
library.  This is done by @dfn{registering} the different library types,
and should be done sometime during program startup.  To make this as
simple as possible, each of the built-in library types has a static
member function called @code{registerlib} for this purpose. 

@example
#include <ringing/xmllib.h>
#include <ringing/cclib.h>

xmllib::registerlib();
cclib::registerlib();

// Now we can open XML and Central Council libraries automatically
@end example

The order in which library types are registered is the order in which
they will be tried when opening a library.

@node The library class, The library_entry class, Initialisation for libraries, Using libraries
@subsection The @code{library} class
@cindex @code{library} class

The @code{library} class provides all the functions you need for opening
and accessing method libraries.  These include:

@itemize @bullet
@item
Constructors for opening method libraries;

@item
Iterator-style functions to access methods;

@item
Functions for accessing methods by name.
@end itemize

Note that the names of methods in libraries may not be what the user
expects.  For example, in MicroSIRIL libraries, method names are run
together into one word, say @samp{Doubledublin}.

@menu
* library derivation::          
* library constructors::        
* library iteration functions::  
* Other library functions::     
@end menu

@node library derivation, library constructors, The library class, The library class
@subsubsection Derivation

This class is not derived from any other classes.

@example
class library;
@end example

@node library constructors, library iteration functions, library derivation, The library class
@subsubsection Constructors

@deftypefn Constructor {} library::library (void);
Constructs an empty (and useless) library object.
@end deftypefn

@deftypefn Constructor {} library::library (const string& @var{filename});
This constructor attempts to automatically detect what type of library 
@var{filename} is, and create an appropriate @code{library} object to 
interpret it.   For a library type to be correctly auto-detected, that
type must be registered @pxref{Initialisation for libraries}.

After constructing a library, the @code{library::good} function can be
used to see whether auto-detection succeeded.
@end deftypefn

In addition to this constructor, which auto-detects the type of library,
it is also possible to open a library of a fixed type, by constructing
an object for a specific library type.  @xref{Built-in library types}.

@node library iteration functions, Other library functions, library constructors, The library class
@subsubsection Iteration functions

The @code{library} class has an associated iterator class.

@deftp {Data type} library::const_iterator;
In the language of the Standard Template Library, this is an @dfn{input
iterator}.  This means that you may only use it to read methods from the
library in order, starting at the beginning.  The value type of the
iterator is @code{library_entry} @pxref{The library_entry class}.
@end deftp

@deftypefn Function {library::const_iterator} library::begin (void) const;
@deftypefnx Function {library::const_iterator} library::end (void) const;
These functions return iterators pointing to the beginning and end of
the library, respectively.
@end deftypefn

This is how these functions may be used to iterate through the library:

@example
// Open a library
library l("my_library.xml");
library::const_iterator i;

// Print the base name of each method in it
for(i = l.begin(); i != l.end(); ++i)
  cout << i->base_name() << endl;
@end example

@node Other library functions,  , library iteration functions, The library class
@subsubsection Other functions

@deftypefun {bool} library::good (void) const;
This function returns true if the library is open and ready to read
methods, and false otherwise.
@end deftypefun

@deftypefun {virtual method} library::load (const char* @var{name}, int @var{stage}) const;
This function loads a method from the library by name.  Note that the
names under which methods are stored in a library depend entirely on the
type of library.

If no such method is found, if exceptions are enabled, an exception of class 
@code{library_base::invalid_name} will be thrown; otherwise, the method 
returned will be an empty method with the name @samp{"Not Found"}.
@end deftypefun

@deftypefun {virtual int} library::dir (list<string>& @var{result}) const;
This function returns a list of the names of the methods in the library.
@end deftypefun

@deftypefun {virtual int} library::mdir (list<method>& @var{result}) const;
This function loads all the methods in the library and returns them as a
list.
@end deftypefun

@node The library_entry class, Facets, The library class, Using libraries
@subsection The @code{library_entry} class
@cindex @code{library_entry} class

The @code{library_entry} class is the value type of the iterator on a
library.  It is used to get information about the method from the
library without constructing a @code{method} object.

@deftypefun string library_entry::name (void) const;
This returns the method's name in whatever form the library stores it 
internally.  Thus it may or may not contain the class name(s) or stage name
of the method.  In the case of MicroSIRIL libraries, it will not even have
whitespace in the name.
@end deftypefun

@deftypefun string library_entry::base_name (void) const;
This returns the base name of the method (i.e. the name with the class name(s)
and stage name removed).  The value returned is suitable for passing to 
the @code{method} constructor.
@end deftypefun

@deftypefun string library_entry::pn (void) const;
This returns a string containing the method's place notation.
@end deftypefun

@deftypefun int library_entry::bells (void) const;
This returns the number of bells on which the method is defined.
@end deftypefun

@deftypefun method library_entry::meth (void) const
This constructs and return a @code{method} object.
@end deftypefun

@deftypefun {template <class Facet> bool} library_entry::has_facet (Facet const* @var{f} = NULL ) const;
This function returns @code{true} if the method entry contains
information about the given facet.  Note that just because a method
library type supports a certain facet, that does not necessarily mean
that every method in the library actually has that facet.  For example,
an entry in a Central Council library may not contain any information
about the first peals in a method; or an entry in an XML library may not
contain certain elements.  

The contents of the argument @var{f} are not used, but this may be used
to indicate the type of the facet as an alternative to explicit template
instantiation.
@end deftypefun

@deftypefun {template <class Facet> typename Facet::type} library_entry::get_facet (Facet const* @var{f} = NULL ) const;
This function returns the value of the specified facet of the method
entry.  

The contents of the argument @var{f} are not used, but this may be used
to indicate the type of the facet as an alternative to explicit template
instantiation.
@end deftypefun

For more information on facets and an example of how these functions are
used, see @ref{Facets}.

@node Facets,  , The library_entry class, Using libraries
@subsection Facets
@cindex facets

In addition to usual information such as name, stage and place notation,
some method collections contain further information.  For example, the
Central Council method collections contain the date and place of the
first peal in each method.  To give access to such information, the
Ringing Class Library has a fully typed system of method @dfn{facets}.

A facet is something which has a C++ type, and which may or may not be
part of an entry in a method library.  A few facets are declared as
standard; library types are free to declare new facets of their own.

For example, one of the standard facets is called @code{rw_ref} and is
of type @code{string}.  The facet is intended to contain a string citing
the method's appearance in the @cite{Ringing World}.  The following code
checks to see whether the first entry in the library @code{l} contains
this information, and if so prints it.

@example
library::iterator i = l.begin();
if( i->has_facet< rw_ref >() )
  cout << i->get_facet< rw_ref >();
@end example

For more information on these functions, see @ref{The library_entry class}.

@menu
* Built-in facets::             
@end menu

@node Built-in facets,  , Facets, Facets
@subsubsection Built-in facets

Some facets are declared in @file{ringing/peal.h}.  These facets are
available in some of the built-in library types.

@table @code
@item rw_ref
This facet, of type @code{string}, contains a reference to the method's
appearance in the @cite{Ringing World}.

@item first_tower_peal
This facet, of type @code{peal}, contains the date and place of the
first tower bell peal in the method.

@item first_hand_peal
This facet, of type @code{peal}, contains the date and place of the
first handbell peal in the method.
@end table

The last two are of type @code{peal}, which is a class also declared in
@file{ringing/peal.h}.  It is a very simple class and defines the
following functions.

@deftypefn Constructor {} peal (void);
@deftypefnx Constructor {} peal (const peal::date& @var{DATE}, const string& @var{PLACE});
These functions construct objects in the obvious way.
@end deftypefn

@deftypefun {peal::date const&} peal::when (void);
This function returns the date of the peal.
@end deftypefun

@deftypefun {string const&} peal::where (void);
This function returns the location of the peal.
@end deftypefun

The @code{peal::date} type is also very simple.

@example
struct peal::date @{
  int day, month, year;
@};
@end example

@deftypefn Constructor {} peal::date (void);
@deftypefnx Constructor {} peal::date (int @var{DAY}, int @var{MONTH}, int @var{YEAR});
These functions construct objects in the obvious way.
@end deftypefn

@node Built-in library types, Library framework, Using libraries, Method libraries
@section Built-in library types

@menu
* XML libraries::               
* Central Council libraries::   
* MicroSIRIL libraries::        
@end menu

@node XML libraries, Central Council libraries, Built-in library types, Built-in library types
@subsection XML libraries
@cindex XML libraries

A specification for method libraries in XML can be found at
@uref{http://methods.ringing.org/}.  This site is also home to a server
which serves XML method data in response to HTTP queries.  The classes
declared in @file{ringing/xmllib.h} can not only parse the XML data, but
can also automatically download method data from the server.

To use XML method libraries, you need to have the Xerces library
from the Apache project, available at @uref{http://xml.apache.org/}.

@menu
* The xmllib class::            
* XML library facets::          
@end menu

@node The xmllib class, XML library facets, XML libraries, XML libraries
@subsubsection The @code{xmllib} class
@cindex @code{xmllib} class

The @code{xmllib} class is derived from the @code{library} class.

@example
class xmllib : public library;
@end example

@deftypefn Constructor {} xmllib::xmllib (xmllib::file_arg_type @var{TYPE}, const string& @var{NAME}); 
This constructor opens an XML library.  The first argument @var{TYPE}
describes what sort of resource is to be opened, and should be one of
the following:

@table @code
@item xmllib::filename
Open a file; @var{NAME} contains the name of the file.

@item xmllib::url
Open a URL; @var{NAME} contains the URL.  To use this, Xerces must have
been built with Internet access.

@item xmllib::default_url
Query the online method database at @uref{http://methods.ringing.org/}.
The argument @var{NAME} contains the query string, that is, the part of
the URL after the @samp{?} character.  For information on what this
should contain, see the detailed information on the database's web site.
@end table
@end deftypefn

@example
// Query the database for all methods named Lincolnshire
xmllib l(xmllib::default_url, "name=Lincolnshire");
@end example

An XML method collection in a file may also be opened using the library
auto-detection mechanism, by simply constructing a @code{library}
object.  @xref{library constructors}.

@deftypefun {static void} xmllib::registerlib (void)
This function registers the XML library type with the library
auto-detection mechanism.
@end deftypefun

@node XML library facets,  , The xmllib class, XML libraries
@subsubsection XML library facets

The XML library type supports only the built-in facets.  @xref{Built-in
facets}.

@node Central Council libraries, MicroSIRIL libraries, XML libraries, Built-in library types
@subsection Central Council libraries

The Methods Committee of the Central Council publishes collections of
methods on its web site, in a text format.  The classes declared in
@file{ringing/cclib.h} can read these method collections.

@menu
* The cclib class::             
* Central Council library facets::  
@end menu

@node The cclib class, Central Council library facets, Central Council libraries, Central Council libraries
@subsubsection The @code{cclib} class

The @code{cclib} class is derived from the @code{library} class.

@example
class cclib : public library;
@end example

There is one constructor.

@deftypefn Constructor {} cclib::cclib (const string& @var{filename});
This function attempts to open the given file as a Central Council method 
library.
@end deftypefn

@deftypefun {static void} cclib::registerlib (void)
This function registers the Central Council library type with the
library auto-detection mechanism.  It will agree to open any file which
has the correct CC copyright notice in the first line.
@end deftypefun

@node Central Council library facets,  , The cclib class, Central Council libraries
@subsubsection Central Council library facets

The Central Council library type supports the built-in facets
@pxref{Built-in facets} and one further facet.

@table @code
@item cclib::ref
This facet, of type @code{int}, contains the reference number of the
method in the library file.  This is the number which appears at the
beginning of the line containing the method.
@end table

@node MicroSIRIL libraries,  , Central Council libraries, Built-in library types
@subsection MicroSIRIL libraries

MicroSIRIL was an ingenious and widely-used early peal proving program
for PCs.  The method libraries used are in a simple text format, with
one method per line; they contain, for each method, simply the name,
lead head code and place notation.

The Ringing Class Library can read MicroSIRIL libraries, providing they
satisfy one requirement: the last portion of the filename, before any
extension, must be the number of bells on which all the methods in the
file are.  This is because it is impossible to tell the stage from just
the place notation.  So, for example, a method library file might be
called @file{s8} or @file{new_principles10.txt}.

Beware that the MicroSIRIL library interface will agree to open any file
having a name satisfying the above requirement.  For this reason, if
auto-detecting method library types, you may want to put the MicroSIRIL
library type at the end of your list.

When reading methods from MicroSIRIL libraries, remember that the name
of each method may only consist of a single word; usually names
consisting of several words are run together into one.

@menu
* The mslib class::             
* MicroSIRIL library facets::   
@end menu

@node The mslib class, MicroSIRIL library facets, MicroSIRIL libraries, MicroSIRIL libraries
@subsubsection The @code{mslib} class

The @code{mslib} class is derived from the @code{library} class.

@example
class mslib : public library;
@end example

There is one constructor.

@deftypefn Constructor {} mslib::mslib (const string& @var{filename});
This function attempts to open the given file as a MicroSIRIL method
library.
@end deftypefn

@deftypefun {static void} mslib::registerlib (void)
This function registers the MicroSIRIL library type with the
library auto-detection mechanism.  It will agree to open any file which
has a name containing a number just before any extension.
@end deftypefun

@node MicroSIRIL library facets,  , The mslib class, MicroSIRIL libraries
@subsubsection MicroSIRIL library facets

There are no facets available for MicroSIRIL libraries.

@node Library framework, Implementing new library classes, Built-in library types, Method libraries
@section Library framework

This section describes in greater detail how the various classes which
implement method libraries interact.  It is intended for those writing
new classes to support new library types.

The basic library framework comprises five classes, all of which are 
declared in the header file @file{ringing/library.h}.

@c Unfortunately it seems that the @code macro cannot be used in the 
@c name argument of @deftp as makeinfo --html can't cope with it.  

@deftp {Class} {class library_base}
This is the basic interface that all implementations will need to implement.
It describes how to iterate through a library, and provides hooks that 
can be used to provide more efficient algorithms for searching through the
library.
@end deftp

@deftp {Class} {class library}
The @code{library} class serves two purposes: it acts as a shared pointer
to a library_base, and it handles the auto-detection of libraries.  
Implementations only need to derive from this if they want to provide an
alternative to the standard auto-detection mechansim.
@end deftp

@deftp {Class} {class library_entry}
This class represents an entry in a library.  It has value semantics; thus 
it is safe to hold onto multiple entries from a single library.
@end deftp

@deftp {Class} {class library_base::const_iterator}
This is an input iterator that iterates over the entries in a library.  
Dereferencing the iterator returns a @code{library_entry}.
@end deftp

@deftp {Class} {class library_entry::impl}
Each @code{library_entry} class holds onto a pointer to one of these.  It
provides an interface to read library entries that all library 
implementations must implement.
@end deftp

@menu
* The library_base class::      
* The library_base const_iterator class::  
* library internals::           
* library_entry internals::     
* The library_entry impl class::  
@end menu

@node The library_base class, The library_base const_iterator class, Library framework, Library framework
@subsection The @code{library_base} class
@cindex @code{library_base} class

The @code{library_base} class provides the interface that library 
implementations must implement to create iterators on a library.  It also has
virtual functions can be overriden to provide more efficient ways to search
and list libraries.

@deftypefn Destructor virtual library_base::~library_base (void);
A virtual destructor.
@end deftypefn

@deftypefun {virtual library_base::const_iterator} library_base::begin (void) const = 0;
This should be overriden to construct a @code{library_base::const_iterator}
pointing to the start of the library.
@end deftypefun 

@deftypefun {library_base::const_iterator} library_base::end (void) const;
This returns a default constructed @code{library_base::const_iterator}
representing one past the end of the library.
@end deftypefun

@deftypefun {virtual bool} library_base::good (void) const = 0;
This function should be overriden to return true if a valid library is 
currently loaded and false otherwise.
@end deftypefun

@deftypefun {virtual method} library_base::load (const char* @var{name}, int @var{stage}) const;
The default implementation of @code{load} iterates through the library
searching for an entry with the correct name.  When comparing method names,
it does so in a case-insensitive manner.  If @var{stage} is non-zero, 
@code{load} requires that the method is on that number of bells.  

If no such method is found, if exceptions are enabled, an exception of class 
@code{library_base::invalid_name} will be thrown; otherwise, the method 
returned will be an empty method with the name @samp{"Not Found"}.

Library implementations may wish to override this if there is a more 
efficient way to locate the method.
@end deftypefun

@deftypefun {virtual int} library_base::dir (list<string>& @var{result}) const;
@deftypefunx {virtual int} library_base::mdir (list<method>& @var{result}) const;
The default implementations of @code{dir} and @code{mdir} iterate through 
the library, pushing each name (in the case of @code{dir}) or method 
(in the case of @code{mdir}) onto @var{result}. The return value is
the number of values pushed onto @code{result}.

Library implementations may wish to override this if there is a more 
efficient way to locate the method.
@end deftypefun

@deftypefun {virtual bool} library_base::writeable (void) const;
@deftypefunx {virtual bool} library_base::save (const method& @var{m});
@deftypefunx {virtual bool} library_base::rename_method (const string& @var{name1}, const string& @var{name2});
@deftypefunx {virtual bool} library_base::remove (const string& @var{name});
These functions are for writing to method libraries.  This functionality is 
still experimental.
@end deftypefun

@node The library_base const_iterator class, library internals, The library_base class, Library framework
@subsection The @code{library_base::const_iterator} class
@cindex @code{library_base::const_iterator} class
@cindex @code{library::const_iterator} class

In the terminology of the STL, the @code{library_entry::const_iterator} class
is an Input Iterator but not a Forward Iterator.  This means that multiple
iterators on the same library will not work as expected.  

@deftypefn Constructor {} library_base::const_iterator::const_iterator (void);
This is the default constructor.  It is undefined behaviour to dereference 
or increment the default constructed @code{library_base::const_iterator}.
@end deftypefn

@deftypefn Constructor {} library_base::const_iterator::const_iterator (library_base* @var{lb}, library_entry::impl* @var{val});
This constructor creates an iterator on library @var{lb} and with a library
entry implementation of @var{val}.  The constructor takes ownership of 
@var{val}, which must have been allocated using @code{new}; it does not take
ownership of @var{lb}.  Typically, this function should only be called
by the @code{begin} function of classes derived from @code{library_base}.
@end deftypefn

@deftypefun bool library_base::const_iterator::operator== (const library_base::const_iterator& @var{other}) const;
@deftypefunx bool library_base::const_iterator::operator!= (const library_base::const_iterator& @var{other}) const;
Compare two iterators.  It is undefined behaviour to compare two iterators 
from different libraries.  
@end deftypefun

@deftypefun library_entry library_base::const_iterator::operator* (void) const;
@deftypefunx library_entry* library_base::const_iterator::operator-> (void) const;
Dereferences an iterator to retrieve the current @code{library_entry}.  It
is undefined behaviour to dereference an iterator that compares equal to 
the end iterator of that library.
@end deftypefun 

@deftypefun library_base::const_iterator& library_base::const_iterator::operator++ (void) const;
@deftypefunx library_base::const_iterator library_base::const_iterator::operator++ (int) const;
The prefix and postfix increment operators move the iterator on to point to 
the next entry in the library.  If there are no further entries in the library,
the iterator will compare equal to the library's end iterator.
@end deftypefun 

@node library internals, library_entry internals, The library_base const_iterator class, Library framework
@subsection @code{library} internals
@cindex @code{library} internals

@deftypefn Constructor {} library::library (void);
Default constructs a library holding a @code{NULL} @code{library_base} 
pointer.
@end deftypefn

@deftypefn Constructor {} library::library (const string& @var{filename});
This constructor attempts to automatically detect what type of library 
@var{filename} is, and create an appropriate @code{library_base} to 
interpret it.   For a library type to be correctly auto-detected a 
function of type @code{library::init_function} must be registered 
with @code{library::addtype}.
After constructing a library, the @code{library::good} function can be
used see if auto-detection succeeded.
@end deftypefn

@deftypefn Constructor {} library::library (library_base* @var{lb});
This constructor is provided to allow libraries the flexibility not to use 
the auto-detection mechanism.  The argument, @var{lb}, must have allocated 
by @code{new} and gets deleted by the @code{library}'s destructor.  
For more information on how to use this, see 
@ref{Alternative creation mechanisms}.
@end deftypefn

@c I've used deftypefn rather than deftp because (i) @deftp formats the 
@c type incorrectly and (ii) the typedef is for a function-pointer.
@deftypefn Typedef {typedef library_base*} {(* library::init_function )} (const string& @var{filename});
Functions with this signature are used by the @code{library} construtor to 
attempt to load a library.  Each derived library class that supports 
auto-detection should register a function of this signature 
with the @code{library} class by calling the @code{library::addtype} function.
When these functions get called, @var{filename} is the name of the
library file.  If a library can read the file it should return a pointer to
a class derived from @code{library_base} allocated with @code{new}; otherwise
the function should return NULL.
@end deftypefn

@deftypefun {static void} library::addtype (library::init_function @var{lt})
This is used to register a specific (derived) library class to the list of 
classes that can be auto-detected.  This function is typically called by the 
static function @code{registerlib} in the derived classes.
@end deftypefun

@deftypefn Typedef {typedef library_base::const_iterator} library::const_iterator;
@deftypefnx Function {library::const_iterator} library::begin (void) const;
@deftypefnx Function {library::const_iterator} library::end (void) const;
If the library holds a @code{library_base}, these function call down to the 
corresponding functions on that, otherwise both functions return a default
constructed @code{const_iterator}.
@end deftypefn

@deftypefun {bool} library_base::good (void) const;
This function returns true if the library is valid, and false otherwise.
@end deftypefun

@deftypefun {virtual method} library::load (const char* @var{name}, int @var{stage}) const;
@deftypefunx {virtual int} library::dir (list<string>& @var{result}) const;
@deftypefunx {virtual int} library::mdir (list<method>& @var{result}) const;
@deftypefunx {virtual bool} library::writeable (void) const;
@deftypefunx {virtual bool} library::save (const method& @var{m});
@deftypefunx {virtual bool} library::rename_method (const string& @var{name1}, const string& @var{name2});
@deftypefunx {virtual bool} library::remove (const string& @var{name});
These functions all call down to the corresponding functions on the 
@code{library_base}; see @ref{The library_base class} for details.
They must not be called if @code{library::good()} is false.
@end deftypefun

@node library_entry internals, The library_entry impl class, library internals, Library framework
@subsection The @code{library_entry} internals
@cindex @code{library_entry} internals

The @code{library_entry} class holds a pointer to a class derived from
@code{library_entry::impl} which reads data from a particular library entry.

@deftypefn Constructor {} library_entry::library_entry (void);
This constructor initialises the @code{library_entry} with a @code{NULL} 
@code{library_entry::impl} pointer.  It is undefined behaviour to call 
any accessor functions on a default constructed @code{library_entry}.
@end deftypefn

@deftypefn Constructor {} library_entry::library_entry (library_entry::impl* @var{PIMPL});
This constructor creates a new object from the given pointer.
@end deftypefn

@deftypefun string name (void) const;
@deftypefunx string base_name (void) const;
@deftypefunx string pn (void) const;
@deftypefunx int bells (void) const;
@deftypefunx method meth (void) const
These functions all call the corresponding function on the
@code{library_entry::impl} object.
@end deftypefun

@node The library_entry impl class,  , library_entry internals, Library framework
@subsection The @code{library_entry::impl} class
@cindex @code{library_entry::impl} class

The @code{library_entry::impl} class provides the interface that library
implementations must implement to parse individual library entries.  Each
@code{library_entry} and @code{library::const_iterator} holds onto one of 
these.

@deftypefn Destructor virtual library_entry::impl::~impl (void);
A virtual destructor.
@end deftypefn

@deftypefun {virtual library_entry::impl*} library_entry::impl::clone (void) const = 0;
This must be overriden to perform a deep copy of the library.  Almost always
this should be implemented as follows:
@example
virtual library_entry::impl* mylib::entry_type::clone() const @{ 
  return new mylib::entry_type(*this); 
@}
@end example
@end deftypefun

@deftypefun {virtual bool} library_entry::impl::readentry (library_base& @var{lb}) const = 0;
The function should be overriden to read the next entry from the library and 
return true unless the end of the library has been reached.  The source of the
data should be held within the @code{library_base} implementation, and not 
this class.  For example, if the library implementation reads from a file via
an @code{ifstream}, the @code{library_base} class should contain the 
@code{ifstream} and this class should access it via @var{lb}:
@example
virtual bool mylib::entry_type::readentry( library_base& lb ) @{ 
  ifstream& ifs = dynamic_cast< mylib& >( lb ).ifs;
  std::getline( ifs, this->entry );
@}
@end example
None of @code{library_entry}'s other functions should ever access the parent
@code{library_base} class.

This function gets called whenever a @code{library::const_iterator} is 
constructed or incremented.
@end deftypefun

@deftypefun {virtual string} library_entry::impl::name (void) const = 0;
@deftypefunx {virtual string} library_entry::impl::base_name (void) const = 0;
These should be overriden to return the name of the current entry.  The
@code{name} function should return a name which is unique within the library
(this may require the class name(s) and/or stage name be included); 
the @code{base_name} function should return the name without either the
class or stage name.

These functions may be implemented to simply return a name that was parsed by 
@code{readentry}; alternatively it might be implemented to parse some 
internal representation of the entry (such as a string containing the 
whole entry).  It must not attempt to access the parent @code{library_base} 
which may no longer exist.  The @code{readentry} function will always have
been called before this function gets called. 
@end deftypefun

@deftypefun {virtual string} library_entry::impl::pn (void) const = 0;
This should be overriden to return the place notation of the current method.
@end deftypefun

@deftypefun {virtual string} library_entry::impl::pn (void) const = 0;
This should be overriden to return the number of bells that the current method
is on.
@end deftypefun

@node Implementing new library classes,  , Library framework, Method libraries
@section Implementing new library classes

There are two ways to implement new library classes, depending on whether or 
not the new library class can support the automatic detection of library type
done in the @code{library(const string& @var{filename})} constructor.  In 
general, if the library is based on a single text file, the auto-detection
mechanism adequately provides a simple way for users of to transparently use 
various types of library.  More complicated types of library, such as those
based on a database, or on multiple files, fit less well with the
auto-detection mechanism, and some alternative mechanism is often better.

@menu
* Supporting auto-detection::   
* Alternative creation mechanisms::  
* Subclassing library_base::    
* Subclassing library_entry impl::  
@end menu

@node Supporting auto-detection, Alternative creation mechanisms, Implementing new library classes, Implementing new library classes
@subsection Supporting auto-detection

The implementation of a new type of library that can be auto-detected needs to 
register a function with the signature @code{library::init_function} with
@code{library::addtype}.  This gets used by the library class when it attempts 
to open a file.  It is often convenient to provide
the library user with a @code{registerlib} function that handles this
registration.  For example, for a type of library file that always starts 
with the line ``My Library File'', the following might be used.

@example
class mylibrary : public library_base @{
public:
  // Allow the user to initialise the library
  static void registerlib(void) @{
    library::addtype(&canread);
  @}

private:
  static library_base *canread(const string& name) @{
    ifstream ifs(name); string first_line;  getline(ifs, first_line);
    if (first_line == "My Library File") return new mylibrary(name);
    return NULL;
  @}

  mylibrary(const string &name);
@};
@end example

In addition, the implementation must override the @code{library_base::good} 
and @code{library_base::begin} virtual functions.  This is discussed elsewhere.

@node Alternative creation mechanisms, Subclassing library_base, Supporting auto-detection, Implementing new library classes
@subsection Alternative creation mechanisms

In cases where it is inappropriate to use the auto-detection mechanism an 
alternative way of initialising @code{library} with a pointer to a subclass of
@code{library_base} must be provided.  To do this, the implementation should
provide subclasses of both @code{library} and @code{library_base}.  The
constructor of the subclass of @code{library} should call down to 
protected @code{library::library (library_base* @var{lb})} constrctor with 
a newly allocated subclass of @code{library_base}.  For example,

@example
class mylibrary : public library @{
private:
  class impl : public library_base @{
    // override virtual functions
  @};

  impl *init_library() @{
    // Do any necessary initialisation
    return new impl;
  @}

public:
  mylibrary() : library( init_library() ) @{@}
@};
@end example

Usually it is sensible to avoid putting any data members or virtual 
functions in @code{mylibrary}, and to put them into @code{mylibrary::impl} 
instead.  This means that if a @code{mylibrary} class is sliced to a 
@code{library} during a copy (for example when passing to a function taking 
a @code{library} by value) the class will still work correctly.

Note that @code{library::~library} is @emph{not} virtual, and thus,
if @code{mylibrary} is ever allocated on the heap, care is required to avoid
deletion via a pointer to its base class.

@node Subclassing library_base, Subclassing library_entry impl, Alternative creation mechanisms, Implementing new library classes
@subsection Subclassing library_base

In addition to providing mechanism for opening libraries, implementations
of new library types must also override at least the @code{library_base::good} 
and @code{library_base::begin} virtual functions.  The implementation of the 
@code{good} function is usually trivial, and @code{begin} only slightly less
so.  Continuing with the example used in @ref{Supporting auto-detection}, they
might be as follows:

@example
class mylibrary : public library_base @{
  mylibrary(const string &filename) : ifs(filename) @{@}

  class entry_type : public library_entry @{ 
    // ...
  @};

  const_iterator make_begin() @{
    ifs.clear(); ifs.seekg(0, ios::beg); // Rewind the stream
    return const_iterator( this, new entry_type );
  @}

  virtual bool good() const @{ return ifs; @}

  virtual const_iterator begin() const @{ 
    return const_cast< mylibrary* >( this )->make_begin();
  @}

  ifstream ifs;
@}
@end example

Notice the slight awkwardness of the @code{const_cast} in @code{begin}.  This
is necessary because the @code{begin} function is sematically constant---it 
does not change the visible state of the library---but it needs to rewind
@var{ifs}.  The stream's position is not part of the visible state
of the library because the @code{library::const_iterator} is only an 
Input Iterator and so only one of them can ever be present at any time.

@node Subclassing library_entry impl,  , Subclassing library_base, Implementing new library classes
@subsection Subclassing library_entry impl

The last step of implementing a library is to provide a class that implements
the @code{library_entry::impl} interface, and most importantly, the 
@code{library_entry::impl::readentry} function.  There are various possible 
implementation strategies: the simplest is to get @code{readentry} to parse
the whole of the library entry, store the name, place notation and so on in 
data members, and then have the @code{name}, @code{pn}, etc. functions return
these.  This is illustrated below:

@example
class mylibrary : public library_base @{
  class my_library::entry_type : public library_entry::impl @{

    // Do a deep-copy of the entry
    virtual library_entry::impl* clone() const @{ 
      return new entry_type(*this); 
    @}

    // Parse the entry
    virtual bool readentry( library_bas& lb ) @{
      ifstream &ifs = dynamic_cast< cclib& >( lb ).ifs;
      if (!ifs) return false; // Have we reached the end of file?
      string entry; getline( ifs, entry );

      // Assume the entry is in the format Method Name:Place Notation
      string::size_type p = linebuf.find(':');
      name_ = string( entry, 0, p );
      pn_   = string( entry, p+1, string::npos );
      return true;
    @}

    // Access parts of the entry
    virtual string name() const @{ return name_; @}
    virtual string pn() const   @{ return pn_;   @}

    string name_, pn_;
  @};

  ifstream ifs;
@};
@end example

An alternative implementation strategy would be to have @code{readline} store
the whole line in data member (i.e. make @var{entry} a data member), and
then get @code{name} and @code{pn} to generate these on-the-fly from the 
@var{entry} string.

@node Proof, Musical Analysis, Method libraries, Top
@chapter Method and Touch Proving
@cindex proving rows
@cindex @code{proof} class

@menu
* The proof class::             
@end menu

@node The proof class,  , Proof, Proof
@section The @code{proof} class

The proof class provides a simple way of checking that a block of rows
are true.  It provides functions for finding out where a particular block
has failed.  Additionally, it will can check blocks that are more than
one extent long.

It is a template class, defined as @code{template <class RowIterator>
class proof;}.  You can therefore decide on your own method of
generating rows, as long as you can provide an iterator (see the
@acronym{STL}) for it.

It will check ALL rows given; therefore, if rounds are at the start and
end, then one of them should be removed before passing to the object.

The proof class only stores the results: it does not make a copy of the
actual rows.  However, pointers to false rows will be stored, so don't
destroy your rows before getting all the proof results.  This may be
changed in a later release.

Note: To avoid problems, make sure that all the rows have the same number
of bells in them, otherwise 12345 will not 123456.

@menu
* proof Derivation::            
* proof Constructors::          
* proof Functions::             
* proof Operators::             
* proof Output::                
* Falseness Storage::           
* How Proof Works::             
@end menu

@node proof Derivation, proof Constructors, The proof class, The proof class
@subsection Derivation

This class is not derived from any other classes.

@example
template <class RowIterator> class proof;
@end example

@node proof Constructors, proof Functions, proof Derivation, The proof class
@subsection Constructors

Where the variable @var{qp} is passed into a function, if this is set to true, the proof class will only check until the row blocks are found to be false, as soon as this is the case, the function will end and store the true/false result. No details will be stored about what lines the row block failed on.

@deftypefn Constructor {} proof::proof (void);
Default Constructor. Sets trueness to false. Use the prove function to provide the rows to prove.
@end deftypefn

@deftypefn Constructor {} proof::proof (RowIterator @var{first}, RowIterator @var{last}, bool @var{qp} = false);
This checks for repeated rows from first to last. Expects up to 1 extent only. Result is stored in class for later retrieval.
@end deftypefn

@deftypefn Constructor {} proof::proof (RowIterator @var{first}, RowIterator @var{last}, const int @var{max}, bool @var{qp} = false);
This checks for repeated rows from first to last. Expects up to @var{max} extents. Result is stored in class for later retrieval.
@end deftypefn

@deftypefn Constructor {} proof::proof (RowIterator @var{true_first}, RowIterator @var{true_last}, RowIterator @var{unknown_first}, RowIterator @var{unknown_last}, bool @var{qp} = false);
This constructor takes two blocks of rows as it parameters. @var{true_first} to @var{true_last} are assumed to be a block of rows that are true. No trueness checking is performed on these rows.
The function looks at rows @var{unknown_first} to @var{unknown_last} comparing them to the true block, and to the unknown block to see if they are repeated anywhere.
The failure information is reset before the analysis takes place, hence any falseness details obtained will be for the new block only.
@end deftypefn

@deftypefn Constructor {} proof::proof (RowIterator @var{true_first}, RowIterator @var{true_last}, RowIterator @var{unknown_first}, RowIterator @var{unknown_last}, const int @var{max}, bool @var{qp} = false);
This constructor acts like the previous, except it will expect up to @var{max} extents (and hence repititions).
@end deftypefn

@node proof Functions, proof Operators, proof Constructors, The proof class
@subsection Functions

Where the variable @var{qp} is passed into a function, if this is set to true, the proof class will only check until the row blocks are found to be false, as soon as this is the case, the function will end and store the true/false result. No details will be stored about what lines the row block failed on.

@deftypefn Function bool proof::prove (RowIterator @var{first}, RowIterator @var{last}, bool @var{qp} = false);
This checks for repeated rows from first to last. Expects up to 1 extent only. Full result is stored in class for later retrieval, but trueness of rows is returned. This function will erase any falseness details stored in the class.
@end deftypefn

@deftypefn Function bool proof::prove (RowIterator @var{first}, RowIterator @var{last}, const int @var{max}, bool @var{qp} = false);
This checks for repeated rows from first to last. Expects up to @var{max} extents. Full result is stored in class for later retrieval, but trueness of rows is returned. This function will erase any falseness details stored in the class.
@end deftypefn

@deftypefn Function bool proof::prove (RowIterator @var{true_first}, RowIterator @var{true_last}, RowIterator @var{unknown_first}, RowIterator @var{unknown_last}, bool @var{qp} = false);
This function takes two blocks of rows as it parameters. @var{true_first} to @var{true_last} are assumed to be a block of rows that are true. No trueness checking is performed on these rows.
The function looks at rows @var{unknown_first} to @var{unknown_last} comparing them to the true block, and to the unknown block to see if they are repeated anywhere.
The failure information is reset before the analysis takes place, hence any falseness details obtained will be for the new block only.
@end deftypefn

@deftypefn Function bool proof::prove (RowIterator @var{true_first}, RowIterator @var{true_last}, RowIterator @var{unknown_first}, RowIterator @var{unknown_last}, const int @var{max}, bool @var{qp} = false);
This function acts like the previous, except it will expect up to @var{max} extents (and hence repititions).
@end deftypefn

@ifinfo
@deftypefn Function {const failinfo&} proof::failed (void) const;
This function simply returns the data detailing where the touch has failed. (*note Falseness Storage::).
@end deftypefn
@end ifinfo
@iftex
@deftypefn Function {const failinfo@&} proof::failed (void) const;
This function simply returns the data detailing where the touch has failed.
@end deftypefn
@end iftex

@node proof Operators, proof Output, proof Functions, The proof class
@subsection Operators

@deftypefn Operator operator proof::int (void) const;
This returns true (or 1) if the touch is true.
@end deftypefn

@deftypefn Operator int proof::operator! (void) const;
This returns true (or 1) if the touch is not true.
@end deftypefn

@node proof Output, Falseness Storage, proof Operators, The proof class
@subsection Output

Output of the proof class is achieved in one of two ways. Either, the functions proof::int and failed() are used, or an overloaded ostream operator for a fixed format.

@ifinfo
@deftypefn Operator {template <class RowIterator> ostream&} operator<< (ostream& @var{o}, const proof<RowIterator>& @var{p});
Outputs to the ostream, @var{o}, if @var{p} is true or false in a predefined format. If p is false, then additional information regarding where is also output.
@end deftypefn
@end ifinfo
@iftex
@deftypefn Operator {template <class RowIterator> ostream@&} operator<< (ostream@& @var{o}, const proof<RowIterator>@& @var{p});
Outputs to the ostream, @var{o}, if @var{p} is true or false in a predefined format. If p is false, then additional information regarding where is also output.
@end deftypefn
@end iftex

@node Falseness Storage, How Proof Works, proof Output, The proof class
@subsection How falseness is stored
@cindex falseness storage

When the proof class finds two or more rows that are the same, it stores the details in a private variable, @var{where}. This can be retrieved by the function @code{failed}. The variable is defined as:

@example
typedef list<linedetail> proof::failinfo;
failinfo @var{where};
@end example

linedetail is a struct defined as:

@example
struct linedetail @{
 row _row;
 list<int> _lines;
@};
@end example

When a row is repeated more than once, a new linedetail item is added to @var{where}. In the linedetail data is stored a pointer, @var{_row}, to the first of the matching rows, and the row numbers are put into @var{_lines}. If the first row given to the class matches the 11th row, then 0 and 10 will be placed into @var{_lines}. If there are three or more rows that all match, then the relevant numbers will be placed into the @var{_lines} list without repeating any.

@node How Proof Works,  , Falseness Storage, The proof class
@subsection How it works
@cindex How proof works

There are two ways that the class can prove blocks of rows depending on if the number of rows is less or greater than an extent. In both methods, the procedures are carried through to the end to allow the user to see where the block of rows is false in all places, not just the first.

@subsection Single Extent

If the single extent version of the function @code{proof::prove} is called, then we follow this procedure.

Here we look at the first row and compare it to the rest. Then we proceed to the second and compare that to the rest (starting from the third, and going to the end). We then continue this until we have completed all the rows. If two rows match the details are stored and the trueness is set to false.

@subsection Multiple Extents

If the multiple extent version of the function @code{proof::prove} is called, then we follow this procedure.

Now we proceed through the list just once. Each row is put into a multimap, if at any time the amount of rows in this map exceed the maximum number of extents then the details are added into the failed information and the trueness is set to false.

@node Musical Analysis, Producing printed output, Proof, Top
@chapter Analysis of Music
@cindex Music Analysis
@cindex music class

The music class provides analysis for music within a set of rows. The
class has been designed around providing a regular-expression style
matching algorithm. This provides flexibility in the way the user can
enter their own music. Additionally, for each 'regular-expression' a
score can be allocated. For a full description of the regular
expressions the ringing library currently provides see Music Regular
Expressions.

The music class processes each row just once, it does not store any
rows. It assumes that the first row given is a handstroke row. The class
should be able to handle any number of bells that the row class can. Note,
that matches for complete rows should be done on a same number of bells basis.

Each time the analysis function is called, the results stored in the
class are reset to zero, and then incremented based on the rows given.

@menu
* Stroke Enumeration::          
* Music Regular Expressions::   
* Using the Music Class::       
* music class definition::      
* music node class definition::  
@end menu

@node Stroke Enumeration, Music Regular Expressions, Musical Analysis, Musical Analysis
@section Stroke Description
@cindex EStroke
@cindex eHandstroke
@cindex eBackstroke
@cindex eBoth

Part of the music class functionality is to allow handstrokes and
backstrokes to be specified independently, or together. An enumeration,
@code{EStroke} is provided to enable this to take place.

It is defined as follows:

@example
enum EStroke
@{
  eHandstroke,
  eBackstroke,
  eBoth
@};
@end example

@node Music Regular Expressions, Using the Music Class, Stroke Enumeration, Musical Analysis
@section Music Regular Expressions
@cindex Regular Expressions
@cindex Specifiying Musical Rows
@cindex Musical Rows
@cindex Music Expressions

The @code{music_details} class provides the means to describe musical
rows to the @code{music} class. The @code{music_details} class stores
details of the expression to be matched (as a string) and an associated
rating, if the user so desires.

Ratings may be positive or negative, this allows a total weighted score
to be calculated from the sum of the result scores. For example, 678s
may be rated at a +2, but 87s at backstroke rated as -10.

When a match sequence is run via the music class, if a row matches that
described by the details provided to a @code{music_details} object, then
the count will be incremented.

The result can either be returned as a raw count, or as a score calculated from the multiplication of the count and the given rating.

If it is specified, then the count or score can be return for just the handstroke, backstroke or both.

Further details relating to the music_details class can be accessed from the menu below:

@menu
* Expression Language::         
* Music_Details class::         
@end menu

@node Expression Language, Music_Details class, Music Regular Expressions, Music Regular Expressions
@subsection Music Regular Expression Language

The regular expression strings describing rows that can be matched as 'musical' can be specified using the following characters:

Representing a bell:

@example
1234567890ETABCDFGHJKLMNPQRSUVWYZ
@end example

Representing any bell:

@example
?
@end example

Representing any bells in any order:

@example
*
@end example

Representing one of several bells in a set position:

@example
[34]
@end example

These constructs can be formed into the following (in all these cases we
are matching with a 6 bell method):

@example
"12??56" In this case we are wishing to know how many rows occur that are 124356 or 123456.
@end example

@example
"135246" In this case we are wishing to know how many times queens occur.
@end example

@example
"*456" In this case we wish to know how many rows there are that finish in 456.
@end example

@example
"654*" In this case we wish to know how many rows there are that start with 654.
@end example

@example
"*456*" In this case we wish to know how many rows have 456 in the middle of them, note this includes rows that start 456 and end 456 as well.
@end example

@example
"*[56]78" in this case we wish to know how many rows end in 578 or 678.
@end example

@node Music_Details class,  , Expression Language, Music Regular Expressions
@subsection Music Details class
@cindex music_details

The music_details class allows the specification of music via a regular
expression to the music class. Although functions are provided to return the
score, they are mainly intended for use by the music class itself. It should
be noted that the music class takes a copy of the music_details object rather
than a pointer.

@deftypefn Constructor {} music_details (const string &e = "", const int &s = 1);
@deftypefnx Constructor {} music_details (const char *e, const int &s = 1);
Creates the object and sets the initial expression to e and the score to use
to s. By default the score is 1. If the specified expression is invalid, the class will throw an @code{music_details::invalid_regex} exception (if they are enabled) or reset the expression to "".
@end deftypefn

@deftypefn Destructor ~music_details ();
Destructor. Doesn't do much in this case.
@end deftypefn

@deftypefun {void} set (const string &e, const int &s = 1);
@deftypefunx {void} set (const char *e, const int &s = 1);
Sets the expression to e and the score to s. It will also reset the counts
of rows matched.
@end deftypefun

@deftypefun {string} get () const;
Returns the currently stored expression.
@end deftypefun

@deftypefun {unsigned int} possible_matches (const unsigned int &bells) const;
Returns the maximum number of possible matches (in one true extent) for the currently specified expression. @var{bells} must be specified as the @code{music_details} class has no knowledge of this under normal circumstances.
@end deftypefun

@deftypefun {int} possible_score (const unsigned int &bells) const;
Returns the maximum possible score (based on one true extent) for the currently specified expression. @var{bells} must be specified as the @code{music_details} class has no knowledge of this under normal circumstances.
@end deftypefun

@deftypefun {unsigned int} count (const EStroke& = eBoth) const;
Returns the number of rows matched based on the stroke that is passed in.
If eBoth is passed, then the result will be the handstroke count plus the
backstroke count.
@end deftypefun

@deftypefun {int} total (const EStroke& = eBoth) const;
Returns the total score based on the stroke that is passed in.
If eBoth is passed, then the result will be the handstroke score plus the
backstroke score.
@end deftypefun

@deftypefun {int} raw_score const;
Returns the score previously specified to the object.
@end deftypefun

@node Using the Music Class, music class definition, Music Regular Expressions, Musical Analysis
@section Using the Music Class

The basic process of using the music class is to create it, specify to it the music that you wish to look for in a set of rows, tell it to process the rows and then obtain the results.

We now describe this in more detail. First create an instance of the music class, specifying to it the number of bells you wish to work with:

@example
music mu(5);
@end example

Now specify the music that you are looking for via the music details class (see @ref{Expression Language} for how to do this). The music class behaves like a @code{vector<music_details>} structure so you can access the elements individually before and after. To add a music specification, do something like this:

@example
music_details md("*45");
mu.push_back(md);
@end example

If you want, more can be added in the same way or by modifying md and pushing the new structure onto the back of the music list:

@example
md.set("*345*");
mu.push_back(md);
@end example

Now you can supply the music class with rows to search against the specified music (note pbdoubles is a vector<row>)

@example
mu.process_rows(pbdoubles.begin(), pbdoubles.end());
@end example

Now you can obtain the results from the music class. You can do this in several ways. The first is to obtain the overall total score, for both strokes, or for one:

@example
cout << "Total Score: " << mu.get_score() << endl;
cout << "Total Score (Backstroke): " << mu.get_score(eBackStroke) << endl;
@end example

The second way is to obtain results for individual items:

@example
music::const_iterator k;

for (k = mu.begin(); k != mu.end(); k++)
  cout << "Total for " << k->get() << ": " << t->count() << " : " << k->total() << endl;
@end example

This produces three columns, the first is the music expression that was searched for, the second is the number of matches, the third is the number of matches based on the score. See the @ref{Music_Details class} for more details on these functions.

@node music class definition, music node class definition, Using the Music Class, Musical Analysis
@section Music Class definition
@cindex music class

The @code{music} class is the main control of the music classes; it stores @code{music_details} objects to match music against and controls the construction of the @code{music_node} tree (see @ref{music node class definition}.

The class must know the number of bells in the rows that are to be examined before the @code{music_class} objects are passed to it; this allows it to create trees of the correct depth and structure to store the regular expressions in search format.

The @code{music_detail} objects are stored in a @code{vector<music_details>} structure, this is accessible via the functions provided (detailed below).

@menu
* Music Derivation::            
* Music Constructors::          
* Music Type Definitions::      
* Music Functions::             
@end menu

@node Music Derivation, Music Constructors, music class definition, music class definition
@subsection Derivation

This class is not derived from any other classes.

@example
class music;
@end example

@node Music Constructors, Music Type Definitions, Music Derivation, music class definition
@subsection Constructors

@deftypefn Constructor {} music::music (const unsigned int &b = 0);
This constructor initialises the number of bells to zero. If you don't specify bells here, you should specify the number of bells by the @code{set_bells()} function before adding expressions to be matched.
@end deftypefn

@node Music Type Definitions, Music Functions, Music Constructors, music class definition
@subsection Type Definitions

This section details the type definitions that the music class creates for the user to use.

@deftypefn typedef vector<music_details> music::mdvector;
This type defines the storage vector that records the expressions to be matched and is also used to obtain the results.
@end deftypefn

@deftypefn typedef vector<music_details>::iterator music::iterator;
@deftypefnx typedef vector<music_details>::const_iterator music::const_iterator;
This type defines a general iterator that can be used to iterate through the stored expressions.
@end deftypefn

@deftypefn typedef vector<music_details>::size_type music::size_type;
This type defines the type of variable returned from the @code{size()} function.
@end deftypefn

@node Music Functions,  , Music Type Definitions, music class definition
@subsection Functions

@deftypefun void push_back (const music_details &);
This function adds a @code{music_details} expression onto the vector of expressions to be matched. It will also add it to the tree ready for processing against rows.
@end deftypefun

@deftypefun music::iterator begin (void);
@deftypefunx music::const_iterator begin (void) const;
These functions return an iterator that points at the beginning of the expression list.
@end deftypefun

@deftypefun music::iterator end (void);
@deftypefunx music::const_iterator end (void) const;
These functions return an iterator that points past the end of the expression list.
@end deftypefun

@deftypefun music::size_type size (void);
This function returns the number of expressions currently stored.
@end deftypefun

@deftypefun void set_bells (const unsigned int &b);
This function sets the number of bells that will be in the matched rows to @code{b}.
@end deftypefun

@deftypefun {template <class RowIterator> void} process_rows (RowIterator first, RowIterator last, bool backstroke = false);
This function first resets the all of the music counts, and then processes the supplied rows. If backstroke is true, then a backstroke is assumed to be the first row, otherwise it will be noted as a handstroke. The stroke will be toggled for every row processed.
@end deftypefun

@deftypefun int get_score (const EStroke& = eBoth);
Returns the score for music matched at the specified stroke. If eBoth is specified as the stroke, then scores for both strokes are added together and returned.
@end deftypefun

@deftypefun unsigned int get_count (const EStroke& = eBoth);
Returns the total number of matches for all music expressions at the specified stroke. If eBoth is specified, then the counts for both strokes are added and returned.
@end deftypefun

@deftypefun int get_possible_score (void);
This function returns the maximum possible score that could be obtained matching the expressions currently stored against a true extent on the number of bells previously specified.
@end deftypefun

@node music node class definition,  , music class definition, Musical Analysis
@section Music Node Class definition
@cindex music_node

The @code{music_node} class provides the main expression matching routines for the @code{music} class. A @code{music} object stores one @code{TopNode} object, (of type @code{music_node}), when expressions are added to the @code{music} object, via a @code{music_details} class, a tree is formed under the @code{TopNode} object.

The @code{music_node} class is normally hidden from the user by the @code{music} class, however, it's functionality is described here to aid maintainance and understanding.

@menu
* Music_Node Full Description::  
* Music_Node Derivation::       
* Music_Node Constructors and Destructors::  
* Music_Node Type Definitions::  
* Music_Node Functions::        
* Music_Node Exceptions::       
@end menu

@node Music_Node Full Description, Music_Node Derivation, music node class definition, music node class definition
@subsection Full Description

Each node in the tree stores the expressions that finish at the node, and pointers to nodes below them, if any have been created. Note, for any node there are a maximum of n pointers, where n is the number of bells, plus one; The extra case in this instance is for a ? or * expression to match any bell.

When a row is to be matched against the expressions stored, each bell in the row is examined individually. If a pointer to a node for the same number as the current bell exists, the matching passes onto the node pointed at. For all cases, if an 'any' pointer exists, then the matching will be passes onto the any node.

When the expression matching comes up against a node where an expression is specified to finish at that node, then the counter for matches against the node is incremented. If there are no matches to the current bell, and the any pointer does not exist, then the matching simply finishes and returns back up the tree.

This is probably better explained by means of an example. Suppose the expression @samp{321654} is added to the TopNode. If @samp{+} is a node, and @samp{|n} is a pointer between the nodes, where n is the number of bell pointed to, then the following tree is formed:

@example
TopNode
|3
+
|2
+
|1
+
|6
+
|5
+
|4
+ @samp{321654} finishes here.
@end example

When the row @samp{326154} is attempted to be matched, the following happens:

@example
TopNode -> Pointer to 3 exists, so go to the next node.
|3
+       -> Pointer to 2 exists, so go to the next node.
|2
+       -> Pointer to 6 (or to any node) does not exist, so terminate.
|1
@end example

Now suppose @samp{321*} and @samp{?2*} is added to the list, the following tree is formed:

@example
            TopNode
               |
-------------------------------
|3                            |any
+                             +
|2                            |2
+                             + @samp{?2*} finishes here.
|1
+ @samp{321*} finishes here.
|6
+
|5
+
|4
+ @samp{321654} finishes here.
@end example

Now, when the row @samp{321654} is put through the matching process, the following happens. Taking first the pointer to bell '3' option of TopNode:

@example
TopNode -> Pointer to 3 exists, so go to the next node.
|3
+       -> Pointer to 2 exists, so go to the next node.
|2
+       -> Pointer to 1 exists, so go to the next node.
|1
+       -> @samp{321*} finishes here so increment, and then as pointer to 6
           exists, carry on to the next node.
|6
+       -> Pointer to 5 exists, so go on.
|5
+       -> Pointer to 4 exists, so go on.
|4
+       -> @samp{321654} finishes here so increment matches. No further
           pointers, so go back up the tree checking for @samp{any} pointers
@end example

When the matching gets back to the top of the tree and finds the any pointer in the top node, it will follow it as below:

@example
TopNode -> Any pointer exists, so follow it
|any
+       -> Note, we are now on the second bell of the row, which in our case
           is @samp{2}, pointer exists, so follow it.
|2
+       -> @samp{?2*} finishes here so increment matches.
@end example

From these examples it can be seen that an optimisation is performed when there is a single @samp{*} left, which saves the matching algorithm going through exvery any node.

@node Music_Node Derivation, Music_Node Constructors and Destructors, Music_Node Full Description, music node class definition
@subsection Derivation

This class is not derived from any other classes.

@example
class music_node;
@end example

@node Music_Node Constructors and Destructors, Music_Node Type Definitions, Music_Node Derivation, music node class definition
@subsection Constructors and Destructors

@deftypefn Constructor {} music_node::music_node (void);
@deftypefnx Constructor {} music_node::music_node (const unsigned int &b);
The constructor initialises the object and sets the number of bells in the rows that will be matched. If the default constructor is used, then the @code{set_bells()} function should be used to perform this action.
@end deftypefn

@deftypefn Destructor {} music_node::~music_node (void);
The destructor will go through the tree structure, deleting the sub-nodes of the current node.
@end deftypefn

@node Music_Node Type Definitions, Music_Node Functions, Music_Node Constructors and Destructors, music node class definition
@subsection Type Definitions

@deftypefn typedef map<unsigned int, music_node*> BellNodeMap;
This map is used to form the structure of the tree. The branches are stored in the structure, with the unsigned int being an index by bell number. Index 0 is for matching any bell. Note, where a node of the tree has no branches coming off of it (because it is the end, or there is nothing else to match against) the map will be empty.
@end deftypefn

@deftypefn typedef BellNodeMap::iterator BellNodeMapIterator;
This type definition is used to provide a shorter type name to iterate the map described above.
@end deftypefn

@deftypefn typedef vector<unsigned int> DetailsVector;
This type definition defines the vector that is used to store the id of the music_details expressions that end at this node.
@end deftypefn

@deftypefn typedef DetailsVector::iterator DetailsVectorIterator;
This type definition is used to provide a shorter type name to iterate the details vector defined above.
@end deftypefn

@node Music_Node Functions, Music_Node Exceptions, Music_Node Type Definitions, music node class definition
@subsection Functions

@deftypefun void set_bells (const unsigned int &b);
This function is used to set the number of bells that will be in the rows to be matched against. This provides a way for the algorithms to know when they are finished processing the expressions or row.
@end deftypefun

@deftypefun void add (const music_details &md, const unsigned int &i, const unsigned int &key, const unsigned int &pos);
This function is used to add the supplied expression (@code{md}), to the tree. The location in the expression to look at is supplied by @code{i}, the @code{key} is the reference number that the @code{music} class stores the @code{md} expression against, and the @code{pos} is the number of bells deep we are in the tree.

Depending on the item in the expression at index @code{i}, the algorithm will do different things, normally, it will call the @code{add_to_subtree(...)} function which in turn will usually call this function again; sometimes it will call itself (in the case of a @samp{'*'}) to move along the current expression without necessarily adding it to a subtree. Hence, the @code{add(...)} function is an iterative one.
@end deftypefun

@deftypefun void add_to_subtree (const unsigned int &place, const music_details &md, const unsigned int &i, const unsigned int &key, const unsigned int &pos, const bool &process_star);
This private function is used to create a branch (if required) and add an expression to a branch of a node. If it cannot allocate memory for the new node, it will either throw a @code{memory_error} exception (if enabled), or it will simply return without going any further.

The @code{place} parameter provides the branch number (= bell) to create and add to, the @code{process_star} parameter is used to indicate if the number of @samp{*}s remaining should be processed or ignored. The rest of the parameters are as for the @code{add(...)} function.
@end deftypefun

@deftypefun void match (const row &r, const unsigned int &pos, vector<music_details> &results, const EStroke &stroke);
This function is iterative and is used to match the expressions stored to a row, @code{r}. If a node is found to have an expression ending there, the number of counts for that expression are incremented according to the specified @code{stroke}. The @code{pos} parameter is used to specify the current position in the row @code{r}, and the @code{results} parameter is the expressions for which the indexes have previously been stored, and against which the count should be incremented as appropriate.
@end deftypefun

@node Music_Node Exceptions,  , Music_Node Functions, music node class definition
@subsection Exceptions

There is one exception defined for this class:

@example
struct memory_error : public overflow_error() @{
  memory_error()
@};

music_node::memory_error::memory_error() 
  : overflow_error("Not enough memory to allocate to music_node item") @{@}
@end example

This is used to indicate that there is not enough memory to add a music_node item.

@node Producing printed output, Copying this manual, Musical Analysis, Top
@chapter Producing printed output
@cindex printing

The Ringing Class Library provides a flexible mechanism for producing
printed output of rows, methods and lines.  The way this mechanism is
designed means that the low-level details of printing are hidden from
the programmer.  Currently the classes in the library support output in
PostScript and PDF formats, and the modularity of the printing system
makes it easy to extend the library to provide other output formats.

Basic printing is provided in two classes: the @code{printpage} class
and the @code{printrow} class.  The first of these deals with placing
text and other objects directly on the page; the second allows for
formatted output of rows and lines.  These classes are both pure virtual
classes, which are specialised by subclasses to allow for different
output formats.

Printing of whole methods is accomplished by the @code{printmethod}
object.  This is not as flexible as the more generic functions of the
lower-level printing objects, but exists to provide a quick and easy way
to print out methods in a moderately variable format.

There are certain rules which should be followed when using the printing
classes.  For a single @code{printpage} object, only one @code{printrow} 
object may exist at any one time.  All @code{printrow} objects associated
to a @code{printpage} object must be destroyed before starting a new page,
and before destroying the @code{printpage} object.  Failure to observe
these rules may result in unusable output.

@menu
* Auxiliary classes::           
* The printpage class::         
* The printrow class::          
* Printing whole methods::      
* Printing in PostScript::      
* Printing to PDF files::       
@end menu

@node Auxiliary classes, The printpage class, Producing printed output, Producing printed output
@section Auxiliary classes

The printing mechanism of the Ringing Class Library declares several 
auxiliary classes, for specifying printing parameters in a device-independent
way.  This section describes those classes.

@menu
* The dimension class::         
* The colour class::            
* The text_style class::        
@end menu

@node The dimension class, The colour class, Auxiliary classes, Auxiliary classes
@subsection The @code{dimension} class

The @code{dimension} class is used extensively by the printing classes
to specify physical dimensions on the page.  The class has three public
data members and one public enumerated type:

@example
class dimension @{
public:
  enum units @{
    points, inches, cm, mm
  @};

  int n, d;
  units u;
@}
@end example

The integers @code{n} and @code{d} hold the numerator and denominator
respectively of the dimension.  The member @code{u} defines which units
the dimension is given in.  For example, a @code{dimension} object
representing three quarters of an inch would have @code{n} equal to 3,
@code{d} equal to 4, and @code{u} equal to @code{dimension::inches}.
Points here are PostScript points, which are equal to 1/72 of an inch.

The @code{dimension} class has several member functions.

@deftypefn Constructor {} dimension::dimension (void);
This constructs a dimension equal to 0.
@end deftypefn

@deftypefn Constructor {} dimension::dimension (int @var{i});
This constructs a dimension equal to @var{i} points.
@end deftypefn

@deftypefn Constructor {} dimension::dimension (int @var{i}, int @var{j}, dimension::units @var{u});
This constructs a dimension equal to the fraction @var{i}/@var{j} in
units @var{u}.
@end deftypefn

@deftypefn Operator dimension dimension::operator- (void)
This operator returns the negation of the dimension.
@end deftypefn

@deftypefn Operator dimension& dimension::operator*= (int @var{i})
@deftypefnx Operator dimension dimension::operator* (int @var{i})
These operators multiply the dimension by the integer @var{i}.
@end deftypefn

@deftypefn Operator dimension& dimension::operator/= (int @var{i})
@deftypefnx Operator dimension dimension::operator/ (int @var{i})
These operators divide the dimension by the integer @var{i}.
@end deftypefn

@deftypefn Operator bool dimension::operator== (int @var{i});
@deftypefnx Operator bool dimension::operator!= (int @var{i});
These operators are only useful for comparing a dimension to 0.
@end deftypefn

@deftypefun void dimension::reduce (void);
This function reduces the fraction @code{n}/@code{d} to lowest terms.
@end deftypefun

@deftypefun float dimension::in_points (void);
This returns a floating point numbers representing the dimension in
points.
@end deftypefun

@deftypefun void dimension::set_float (float @var{value}, int @var{denom}, units @var{uu}=points);
This function sets the dimension to an approximation of the given 
floating-point number @var{value}.  Specifically, the denominator is set
to @var{denom}, and the numerator is set to the integer closest to
the product of @var{value} and @var{denom}.
@end deftypefun

@deftypefun void dimension::read (const string& @var{s});
@deftypefunx void dimension::read (const char* @var{s});
These functions read a dimension from a string.  The string should contain
following parts:
@itemize @bullet
@item An optional minus sign;

@item a number, in either decimal format or as a fraction;

@item the units.
@end itemize

For example, the following strings would all be recognised: @samp{0.4 cm};
@samp{1 1/2"}, @samp{56 pt}.  The allowed unit names are @samp{pt}, 
@samp{points}, @samp{point}, @samp{in}, @samp{inch}, @samp{inches},
@samp{"}, @samp{cm}, @samp{mm}.
@end deftypefun

@deftypefun string& dimension::write (string& @var{s});
This function writes the dimension to the string @var{s}.
@end deftypefun

@node The colour class, The text_style class, The dimension class, Auxiliary classes
@subsection The @code{colour} class

The @code{colour} class is a structure which represents a colour.  It
is defined thus:

@example
struct colour @{ bool grey; float red, green, blue; @};
@end example

The red-green-blue (@acronym{RGB}) colour space is used to specify
colours.  This is not particularly well suited to printing, where a
subtractive colour model such as @acronym{CMYK} is more useful, but
@acronym{RGB} is at least very widely used.  Colours printed using the
Ringing Class Library will probably vary quite a lot from one device to
another, but your blue lines will be blue and your red lines will be
red.

To specify a colour in a @code{colour} object, simply set @code{grey} to 
@code{false} and set the other three members to numbers between 0 and 1,
inclusive.  You can also specify a shade of grey by setting @code{grey} to
@code{true}; then the @code{red} element specifies the shade of grey, from
0 (black) to 1 (white).

@node The text_style class,  , The colour class, Auxiliary classes
@subsection The @code{text_style} class

The @code{text_style} class is a structure which represents a text
style.  It contains a font name, a size in tenths of a point and a
colour.  It also defines an enumerated type which may be used to
describe text alignment.

@example
struct text_style @{
  string font;
  int size;
  colour col;
  enum alignment @{ left, right, centre @};
@};
@end example

Font names are dependent on the output device; as the only output device
currently supported is a PostScript device, the font name should be a
PostScript font name such as @samp{Helvetica-Oblique} or @samp{Times-Roman}.

@node The printpage class, The printrow class, Auxiliary classes, Producing printed output
@section The @code{printpage} class

The @code{printpage} class takes control of producing printed output on
a page.  To start printing, an object of some subclass of
@code{printpage} is created, which will handle all further printing.
For example, to print to a PostScript stream or file, an object of class
@code{printpage_ps} would be created.  Once the @code{printpage} class
has been created, it can be used to place text directly on the page.  It
can also be used to create @code{printrow} objects for printing rows and
lines.

Note that positions on the page are always measured from the bottom left 
corner.

The @code{printpage} class is a pure virtual class:  the only way to create
one is by constructing an object of a derived class.

@deftypefun void printpage::new_page (void);
This tells the @code{printpage} object to finish printing the current
page and start a new page.  
@end deftypefun

@deftypefun {virtual void} printpage::text (const string @var{t}, const dimension& @var{x}, const dimension& @var{y}, text_style::alignment @var{a}, const text_style& @var{s});
This function places a text string on the page.  The string is given in
@var{t} and should consist of printable characters.  The position at
which the string is to be printed, measured from the bottom left corner
of the page, is given by @var{x} and @var{y}.  The alignment of the text
about this point is given by @var{a}, and the text style is given by
@var{s}.
@end deftypefun

@node The printrow class, Printing whole methods, The printpage class, Producing printed output
@section The @code{printrow} class

Printing of rows and lines is handled by the @code{printrow} class and its
subclasses.  An object of type @code{printrow} is created, attached to
a given @code{printpage} object.  After the object has been created, it
can be given rows to print.  The rows can be printed in various ways:  the
actual numbers representing the row may or may not be printed, and lines
can be drawn for selected bells.

@menu
* Using the printrow class::    
* Row printing options::        
@end menu

@node Using the printrow class, Row printing options, The printrow class, The printrow class
@subsection Using the @code{printrow} class

A @code{printrow} object is created by one of the following constructors.
Note that there are certain options which cannot be changed once the
object has been created, so unless the default options are going to be
used it is necessary to use the second form of the constructor.

@deftypefn Constructor {} printrow::printrow (const printpage& @var{pp});
This constructor builds a @code{printrow} object associated to the
@code{printpage} object given by @var{pp}.  The options are initialised
to the default options.
@end deftypefn

@deftypefn Constructor {} printrow::printrow (const printpage& @var{pp}, const printrow::options& @var{op});
This constructor builds a @code{printrow} object associated to the
@code{printpage} object given by @var{pp}, and initialised the options
to @var{op}.
@end deftypefn

Once the @code{printrow} object has been created, it must be positioned
on the page before any rows can be printed.

@deftypefun void printrow::set_position (const dimension& @var{x}, const dimension& @var{y});
This function sets the position of the @code{printrow} object to the given
place on the page, measured from the bottom left.  The position given is 
where the first bell of the next row printed will appear.
@end deftypefun

@deftypefun void printrow::move_position (const dimension& @var{x}, const dimension& @var{y});
This function is like the preceding one, but the position given by @var{x} 
and @var{y} are taken relative to the current position of the @code{printrow}
object.  The current position is either the place where the top left bell of
the last column printed appeared, or as set by a @code{set_position} or
@code{move_position} function call, whichever is more recent.
@end deftypefun

Certain options (@pxref{Row printing options}) may be changed while the
@code{printrow} object exists.

@deftypefun {const printrow::options&} printrow::get_options (void);
This function returns the current options.
@end deftypefun

@deftypefun void printrow::set_options (const printrow::options& @var{o});
This function sets the options to those given by @var{o}.  Note that
only certain option changes will have any effect once the object has
been constructed.
@end deftypefun

After setting the position, rows can be printed.

@deftypefn Operator printrow& printrow::operator<< (const printrow& @var{pr}, const row& @var{r});
This operator is used to print a row @var{r} using the @code{printrow} 
object @var{pr}.  This prints the numbers of the row if the @code{numbers}
flag of the options is set, and also draws the lines for any bells which
have been specified in the options.  The row is printed underneath the 
previous row.
@end deftypefn

@deftypefun void printrow::rule (void);
This function draws a horizontal rule below the last row printed.
@end deftypefun

@deftypefun void printrow::dot (int @var{i});
This function draws a small dot at the place where bell @var{i} was in the
last row printed.  If @var{i} is -1, prints dots for all bells which are
having lines drawn.
@end deftypefun

@deftypefun void printrow::placebell (int @var{i});
This function finds what place the bell @var{i} was at in the last row 
printed, and then prints this number in a circle to the right of that row.
@end deftypefun

@deftypefun  void printrow::text (const string& @var{t}, const dimension& @var{x}, text_style::alignment @var{al}, bool @var{between}, bool @var{right});
This function prints some text to one side of the last row printed.  The
text is given in @var{t} and is printed in the same style as the rows.
If the boolean argument @var{right} is true, the text is printed to the
right of the row; otherwise the text is printed to the left of the row.
The dimension @var{x} is a distance from the leftmost or rightmost
number in the row, and the text is aligned about this point as given by
@var{al} (@pxref{The text_style class}).  If the argument @var{between}
is true, then the text is not aligned vertically with the previous row,
but rather appears halfway between the previous row and the next one to
be printed.  This last option is useful, for example, for printing place
notation beside a method.
@end deftypefun

@node Row printing options,  , Using the printrow class, The printrow class
@subsection Row printing options

The way in which rows are printed by a @code{printrow} object is
controlled by various options.  These options are given by a 
@code{printrow::options} object.

@example
struct options @{
  enum o_flags @{
    numbers = 0x01,
    miss_numbers = 0x02
  @};
  unsigned int flags;
  text_style style;
  dimension xspace, yspace;
  struct line_style @{
    dimension width;
    colour col;
  @};
  map<int, line_style> lines;

  void defaults(void);
@};
@end example

The @code{flags} member contains various flags; bit values are given by
the enumerated type @code{o_flags}, and possible values for @code{flags}
can be obtained by logically ORing these values together.  The bits
are as follows:
@itemize @bullet
@item
The @code{options::numbers} bit controls whether the actual numbers of the
rows are printed.  If this bit is not set, only lines will be printed.

@item
If the @code{options::miss_numbers} bit, then any numbers which would
appear underneath lines are missed out.  An example of this may be seen
in the @cite{Ringing World} diary, where all rows except lead heads are
printed with this property.
@end itemize
This option may be changed, with immediate effect, at any point during 
printing.

The @code{style} member controls the style in which the rows are
printed; for the declaration of the @code{text_style} class, see
@ref{The text_style class}.  This option may not be changed during printing.

The @code{xspace} and @code{yspace} members give the horizontal space
between numbers in a row, and the vertical space between rows, respectively.
For the declaration of the @code{dimension} class, see
@ref{The dimension class}.  These options may not be changed during 
printing.

The @code{lines} member controls which ``blue lines'' are printed.  Each
element of the map has an integer, denoting the bell number, and a
@code{line_style} element which defines the style of the line.  The two
members of @code{line_style} are a @code{dimension} object, giving the
width of the line, and a @code{colour} object, giving the colour of the
line.  This option may be changed in between columns, but not in the
middle of a column.

For example, suppose that we wish to print rows in 10-point Helvetica, with
spacing of 12 points horizontally and vertically.  We want to draw a blue
line half a point thick for the second bell.  The following code sets
up a @code{printrow::options} object to accomplish this:

@example
printrow::options o;
o.flags = printrow::options::numbers;
o.style.size = 100;
o.style.font = "Helvetica";
o.xspace.n = 12;
o.yspace.n = 12;
line_style s; s.width.n = 1; s.width.d = 2; s.width.u = dimension::points;
s.col.grey = false; s.col.red = 0; s.col.green = 0; s.col.blue = 1.0;
o.lines[1] = s;
@end example

There is one member function of @code{printrow::options}.

@deftypefun void printrow::options::defaults (void);
This function sets up the @code{printrow::options} object to the defaults
as given in the example above.
@end deftypefun

@node Printing whole methods, Printing in PostScript, The printrow class, Producing printed output
@section Printing whole methods

It should be reasonably clear how the @code{printrow} object might be
used to print out numbers and lines for a method.  This simple but
tedious task is automated by the @code{printmethod} object.  The
@code{printmethod} object is not designed to be as flexible as the rest
of the printing mechanism, but rather to accomplish its one aim, that of
printing out methods, in as simple a way as possible.

The appearance of the printed method is controlled by setting the public
data members of the @code{printmethod} object.  When all the parameters
have been set up, the function @code{printmethod::print()} is used to
print the method to a given @code{printpage} object.

The output consists of a series of @dfn{columns}, each of which contains
the same number of rows.  When one column is full, a new column is
started to the right of the last one.  A number of columns, side by
side, are called a @dfn{column set}.  When one column set is complete, a
new column set is started below the last.  Whenever a new column is
started, the last row of the previous column is duplicated at the top of
the new column.

@menu
* Method printing parameters::  
* Using the printmethod object::  
@end menu

@node Method printing parameters, Using the printmethod object, Printing whole methods, Printing whole methods
@subsection Method printing parameters

The @code{printmethod} object has many public data members, which
control the format of the printed method.  These public data members are
described here.

@deftypevar printrow::options printmethod::opt
This member contains the options which are used to print each separate
row of the method.  For more information on this object, see @ref{Row
printing options}.  Note that the @code{miss_numbers} flag is overridden
by the setting of the @code{number_mode} member of the
@code{printmethod} object (see below).
@end deftypevar

@deftypevar dimension printmethod::hgap
@deftypevarx dimension printmethod::vgap
These two members control the horizontal gap between columns, and the
vertical gap between column sets, respectively.  For more information on
the @code{dimension} class, see @ref{The dimension class}.
@end deftypevar

@deftypevar int printmethod::total_rows
This integer sets the total number of rows which will be printed.  This
total does not count those rows which are duplicated because they appear
at the end of a column.
@end deftypevar

@deftypevar int printmethod::rows_per_column
This integer controls the number of rows printed in each column.  In
fact each column will contain one more than this number of rows, because
the last row of each column is duplicated at the top of the next column.
@end deftypevar

@deftypevar int printmethod::columns_per_set
This integer controls the number of columns which appear in each
horizontal column set, that is, the number of columns across the printed
output.
@end deftypevar

@deftypevar int printmethod::sets_per_page
This integer controls the number of column sets which appear on each
page, that is, the number of columns down the printed page.  If the total
number of columns printed exceeds this numbers, more than one page of
output will be produced.
@end deftypevar

@deftypevar dimension printmethod::xoffset
@deftypevarx dimension printmethod::yoffset
These two members position the output on the page.  Together, they
contain the position of the top left bell of the top left column of the
output. measured from the bottom left hand corner of the page.  For more
information on the @code{dimension} class, see @ref{The dimension class}.
@end deftypevar

@deftypevar {list<pair<int, int> >} printmethod::rules
This member controls the printing of horizontal rules in the output.
Each entry in the list is a pair (@var{a}, @var{b}) of integers; this
entry means that a rule will be drawn after the @var{a}th row in each
lead, and every @var{b} rows after that.  For example, the usual setting
for a treble dodging method would be the pair (4,4), indicating that
rules should be drawn every four rows, starting with a rule after the
fourth row.  Similarly the usual setting for Stedman would be the pair
(3,6).
@end deftypevar

@deftypevar printmethod::number_mode_t printmethod::number_mode
This member sets the behaviour with regard to missing numbers underneath
lines.  There are four possible settings, described by an enumerated
type:
@example
enum number_mode_t @{ miss_never, miss_always, 
                      miss_column, miss_lead @};
@end example
The meaning of these options is as follows:

@itemize @bullet
@item @code{miss_never}: numbers are always drawn;
@item @code{miss_always}: numbers are never drawn when they appear
underneath a line;
@item @code{miss_column}: numbers are only drawn underneath lines in the
first and last rows of a column;
@item @code{miss_lead}: numbers are only drawn underneath lines at lead
heads.
@end itemize
@end deftypevar

@deftypevar printmethod::pn_mode_t printmethod::pn_mode
This member controls the printing of place notation next to the method.
There are three possible settings, described by an enumerated type:
@example
enum pn_mode_t @{ pn_none, pn_first, pn_all @};
@end example
These options are interpreted as follows:

@itemize @bullet
@item @code{pn_none}: place notation is never printed;
@item @code{pn_first}: place notation is printed to the left of the
first lead of the method and, if the method is symmetrical about the
half lead, only the first half of the place notation and the lead end
are printed;
@item @code{pn_all}: full place notation is printed to the left of every
lead.
@end itemize
@end deftypevar

@deftypevar int printmethod::placebells
This integer controls whether place bells are printed, and for which
bell.  If this member contains an integer greater than or equal to zero,
then place bells are printed for the corresponding bell.  To suppress
the printing of place bells, set this member to @code{-1}.
@end deftypevar

@node Using the printmethod object,  , Method printing parameters, Printing whole methods
@subsection Using the @code{printmethod} object

Before printing a method using a @code{printmethod} object, two things
must be set up:  the object must be given a method to print, and the
parameters for printing described in the previous section must be
initialised.

The class has two constructors:

@deftypefn Constructor {} printmethod::printmethod (void);
@deftypefnx Constructor {} printmethod::printmethod (const method& @var{m});
These two constructors create a @code{printmethod} object.  In the first
case, no method is specified; a method will have to be given later,
before anything can be printed.  In the second case, a reference to the
method @var{m} is stored for printing after the parameters have been set
up.
@end deftypefn

After the object has been created, the method can be queried and changed
with these functions:

@deftypefun {const method&} printmethod::get_method (void);
This returns the method referred to by this @code{printmethod} object.
@end deftypefun

@deftypefun void printmethod::set_method (const method& @var{m});
This function stored a reference to the method @var{m} in the
@code{printmethod} object, for subsequence printing.
@end deftypefun

The parameters for printing, described in the previous section, may be
manipulated with several member functions.

@deftypefun void printmethod::defaults (void);
This function sets the parameters to default values, which relate to the
method to be printed; so it should not be called before a method has
been given to the @code{printmethod} object.  Specifically, the
parameters are set as follows:

@itemize @bullet
@item Numbers are to be printed in 10-point Helvetica, and the spacing
between bells is 12 points both horizontally and vertically;
@item Each column contains a single lead; an entire plain course of the
method will be printed, with leads side by side;
@item The output is positioned at the bottom left of the page;
@item Numbers will be missed underneath lines, except for lead heads;
@item Place notation will be printed to the left of the first lead only;
@item Each hunt bell is shown with a red line, a quarter of a point
thick;
@item The smallest working bell which makes a place over the lead end is
shown with a blue line, half a point thick, and place bells are shown
for this bell.  If no working bell makes a place over the lead end, the
smallest working bell is chosen instead.
@end itemize
@end deftypefun

@deftypefun void printmethod::fit_to_space (const dimension& @var{width}, const dimension& @var{height}, bool @var{vgap_mode}, float @var{aspect});
This function scales and arranges the method to fit in the given space,
as specified by @var{width} and @var{height}.  The parameters which are
calculated by this function are @code{rows_per_column},
@code{columns_per_set}, @code{hgap}, @code{vgap}, @code{opt.style.size},
@code{opt.xspace} and @code{opt.yspace}.  Two possible layouts are
possible: if @var{vgap_mode} is @code{false}, then only one column set
is used, with each column containing a whole number of leads; if
@var{vgap_mode} is @code{true}, then each column contains precisely one
lead, and as many column sets as necessary are used.  The effect of this
is that, in the first case, the second lead appears below the first one;
in the second case, the second lead appears to the right of the first
one.  The last argument @var{aspect} sets the ratio of @code{opt.xspace}
to @code{opt.yspace}.

The chosen layout is that which, given the constraints specified, allows
the largest of output.
@end deftypefun

@deftypefun float printmethod::total_width (void);
@deftypefunx float printmethod::total_height (void);
These functions give the total width and height, respectively, in points
of the printed output using the current parameters.
@end deftypefun

@node Printing in PostScript, Printing to PDF files, Printing whole methods, Producing printed output
@section Printing in PostScript

The Ringing Class Library provides subclasses of the @code{printpage} and
@code{printrow} classes for producing output in the PostScript language.  
These classes are declared in the @file{ringing/print_ps.h} header file.
The output conforms to the Document Structuring Conventions (@acronym{DSC})
version 3.0 and uses only Level 1 language.

The @code{printpage_ps} class is derived from @code{printpage}, and handles
all output to a PostScript stream.  The new functions in this class are
constructors and some PostScript-specific operations.

@deftypefn Constructor {} printpage_ps::printpage_ps (ostream& @var{o});
This creates a new PostScript printing object, which will send its
output to the stream @var{o}.
@end deftypefn

@deftypefn Constructor {} printpage_ps::printpage_ps (ostream& @var{o}, const dimension& @var{page_height});
This creates a new PostScript printing object, which will send its output
to the stream @var{o}.  Each page will be printed with landscape orientation;
because of the way PostScript works, this means that the page height must
be given.
@end deftypefn

@deftypefn Constructor {} printpage_ps::printpage_ps (ostream @var{o}, int @var{x0}, int @var{y0}, int @var{x1}, int @var{y1});
This creates a new object which will write an Encapsulated PostScript
(@acronym{EPS}) file to the stream @var{o}.  The bounding box for the
@acronym{EPS} file is specified in points by the arguments @var{x0}, @var{y0},
@var{x1} and @var{y1}.  This bounding box has no effect on where you can
print things using this object, but other applications manipulating the
@acronym{EPS} file may rely on the bounding box in order to work properly.
@end deftypefn

The @code{printrow_ps} class is for printing rows to a @code{printpage_ps}
object.  You will probably never have to deal with this class directly, as
it should be created and dealt with by the interface for the @code{printrow}
class.

@node Printing to PDF files,  , Printing in PostScript, Producing printed output
@section Printing to @acronym{PDF} files

Subclasses of the @code{printpage} and @code{printrow} classes are also
provided for providing output in Adobe Portable Document Format
(@acronym{PDF}).  These classes are declared in the @code{print_pdf.h}
header file.

Some specific issues must be considered when creating @acronym{PDF}
files.  Firstly, although the classes support output to an arbitrary
stream, some care must be taken.  This is because @acronym{PDF} files
contain tables which cross-reference different parts of the file; and
these tables therefore contain byte offsets into the file.  If you use
the @acronym{PDF} printing classes to write to a text-mode file on some
system, such as Microsoft Windows, which convert single line feeds to
carriage-return and line-feed pairs, then this byte count will be
incorrect.  The safe way round this is to @strong{always open
@acronym{PDF} output streams in binary mode}.

The second specific issue which arises when creating a @acronym{PDF}
file is that of fonts.  In order to position text correctly on the page,
the class library needs to know the metrics of every character in each
font used.  As a result, it is only possible to use the standard 14
@acronym{PDF} fonts when printing from the Ringing Class Library.  These
standard fonts are:
@itemize @bullet
@item Courier, Courier-Bold, Courier-Oblique, Courier-BoldOblique

@item Helvetica, Helvetica-Bold, Helvetica-Oblique, Helvetica-BoldOblique

@item Times-Roman, Times-Bold, Times-Italic, Times-BoldItalic

@item Symbol

@item ZapfDingbats
@end itemize

The @code{printpage_pdf} class is derived from @code{printpage}.  The only
new functions defined in this class are its two constructors:

@deftypefn Constructor {} printpage_pdf::printpage_pdf (ostream& @var{o}, const dimension& @var{width}, const dimension& @var{height}, bool @var{l}=false);
This constructor creates an object for writing a @acronym{PDF} file to the
output stream @var{o}.  The page width and height are set to @var{width} and 
@var{height} respectively.  If the Boolean parameter @var{l} is set,
the page will be printed in landscape format.
@end deftypefn

@deftypefn Constructor {} printpage_pdf::printpage_pdf (ostream& @var{o}, bool @var{l}=false);
This constructor works as the previous one, but the page size is set to A4.
@end deftypefn

The subclass of @code{printrow} for printing to a @acronym{PDF} file is called
@code{printrow_pdf}; but as an object of this class will always be created
through the parent @code{printpage} object, the programmer should never
need to deal with the @code{printrow_pdf} class.

@node Copying this manual, Index, Producing printed output, Top
@appendix Copying this manual

@menu
* GNU Free Documentation License::  
@end menu

@node GNU Free Documentation License,  , Copying this manual, Copying this manual
@appendixsec GNU Free Documentation License

@cindex FDL, GNU Free Documentation License
@center Version 1.1, March 2000

@display
Copyright @copyright{} 2000 Free Software Foundation, Inc.
59 Temple Place, Suite 330, Boston, MA  02111-1307, USA

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
@end display

@enumerate 0
@item
PREAMBLE

The purpose of this License is to make a manual, textbook, or other
written document @dfn{free} in the sense of freedom: to assure everyone
the effective freedom to copy and redistribute it, with or without
modifying it, either commercially or noncommercially.  Secondarily,
this License preserves for the author and publisher a way to get
credit for their work, while not being considered responsible for
modifications made by others.

This License is a kind of ``copyleft'', which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.

@item
APPLICABILITY AND DEFINITIONS

This License applies to any manual or other work that contains a
notice placed by the copyright holder saying it can be distributed
under the terms of this License.  The ``Document'', below, refers to any
such manual or work.  Any member of the public is a licensee, and is
addressed as ``you''.

A ``Modified Version'' of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

A ``Secondary Section'' is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject.  (For example, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

The ``Invariant Sections'' are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.

The ``Cover Texts'' are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.

A ``Transparent'' copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, whose contents can be viewed and edited directly and
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup has been designed to thwart or discourage
subsequent modification by readers is not Transparent.  A copy that is
not ``Transparent'' is called ``Opaque''.

Examples of suitable formats for Transparent copies include plain
@sc{ascii} without markup, Texinfo input format, La@TeX{} input format,
@acronym{SGML} or @acronym{XML} using a publicly available
@acronym{DTD}, and standard-conforming simple @acronym{HTML} designed
for human modification.  Opaque formats include PostScript,
@acronym{PDF}, proprietary formats that can be read and edited only by
proprietary word processors, @acronym{SGML} or @acronym{XML} for which
the @acronym{DTD} and/or processing tools are not generally available,
and the machine-generated @acronym{HTML} produced by some word
processors for output purposes only.

The ``Title Page'' means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, ``Title Page'' means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

@item
VERBATIM COPYING

You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

You may also lend copies, under the same conditions stated above, and
you may publicly display copies.

@item
COPYING IN QUANTITY

If you publish printed copies of the Document numbering more than 100,
and the Document's license notice requires Cover Texts, you must enclose
the copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a publicly-accessible computer-network location containing a complete
Transparent copy of the Document, free of added material, which the
general network-using public has access to download anonymously at no
charge using public-standard network protocols.  If you use the latter
option, you must take reasonably prudent steps, when you begin
distribution of Opaque copies in quantity, to ensure that this
Transparent copy will remain thus accessible at the stated location
until at least one year after the last time you distribute an Opaque
copy (directly or through your agents or retailers) of that edition to
the public.

It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.

@item
MODIFICATIONS

You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

@enumerate A
@item
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

@item
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has less than five).

@item
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

@item
Preserve all the copyright notices of the Document.

@item
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

@item
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

@item
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document's license notice.

@item
Include an unaltered copy of this License.

@item
Preserve the section entitled ``History'', and its title, and add to
it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section entitled ``History'' in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

@item
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the ``History'' section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

@item
In any section entitled ``Acknowledgments'' or ``Dedications'',
preserve the section's title, and preserve in the section all the
substance and tone of each of the contributor acknowledgments
and/or dedications given therein.

@item
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

@item
Delete any section entitled ``Endorsements''.  Such a section
may not be included in the Modified Version.

@item
Do not retitle any existing section as ``Endorsements''
or to conflict in title with any Invariant Section.
@end enumerate

If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice.
These titles must be distinct from any other section titles.

You may add a section entitled ``Endorsements'', provided it contains
nothing but endorsements of your Modified Version by various
parties---for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.

@item
COMBINING DOCUMENTS

You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice.

The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

In the combination, you must combine any sections entitled ``History''
in the various original documents, forming one section entitled
``History''; likewise combine any sections entitled ``Acknowledgments'',
and any sections entitled ``Dedications''.  You must delete all sections
entitled ``Endorsements.''

@item
COLLECTIONS OF DOCUMENTS

You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.

@item
AGGREGATION WITH INDEPENDENT WORKS

A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, does not as a whole count as a Modified Version
of the Document, provided no compilation copyright is claimed for the
compilation.  Such a compilation is called an ``aggregate'', and this
License does not apply to the other self-contained works thus compiled
with the Document, on account of their being thus compiled, if they
are not themselves derivative works of the Document.

If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one quarter
of the entire aggregate, the Document's Cover Texts may be placed on
covers that surround only the Document within the aggregate.
Otherwise they must appear on covers around the whole aggregate.

@item
TRANSLATION

Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License provided that you also include the
original English version of this License.  In case of a disagreement
between the translation and the original English version of this
License, the original English version will prevail.

@item
TERMINATION

You may not copy, modify, sublicense, or distribute the Document except
as expressly provided for under this License.  Any other attempt to
copy, modify, sublicense or distribute the Document is void, and will
automatically terminate your rights under this License.  However,
parties who have received copies, or rights, from you under this
License will not have their licenses terminated so long as such
parties remain in full compliance.

@item
FUTURE REVISIONS OF THIS LICENSE

The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
@uref{http://www.gnu.org/copyleft/}.

Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License ``or any later version'' applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.
@end enumerate

@page
@appendixsubsec ADDENDUM: How to use this License for your documents

To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:

@smallexample
@group
  Copyright (C)  @var{year}  @var{your name}.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.1
  or any later version published by the Free Software Foundation;
  with the Invariant Sections being @var{list their titles}, with the
  Front-Cover Texts being @var{list}, and with the Back-Cover Texts being @var{list}.
  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
@end group
@end smallexample

If you have no Invariant Sections, write ``with no Invariant Sections''
instead of saying which ones are invariant.  If you have no
Front-Cover Texts, write ``no Front-Cover Texts'' instead of
``Front-Cover Texts being @var{list}''; likewise for Back-Cover Texts.

If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.

@c Local Variables:
@c ispell-local-pdict: "ispell-dict"
@c End:

@node Index,  , Copying this manual, Top
@unnumbered Index

@printindex cp

@bye
